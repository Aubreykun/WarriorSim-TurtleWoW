const MAX_WORKERS=navigator.hardwareConcurrency||8,WEB_DB_URL="https://classic.wowhead.com/";var SIM=SIM||{};SIM.UI={init:function(){this.variables(),this.events(),this.loadSession(),this.loadWeapons("mainhand"),this.updateSidebar(),this.main.find(".js-import").hide(),this.main.find(".js-export").hide(),this.body.on("click",".wh-tooltip, .tablesorter-default a",function(t){t.preventDefault()})},variables:function(){this.body=$("body"),this.buffs=this.body.find("article.buffs"),this.fight=this.body.find("article.fight"),this.rotation=this.body.find("article.rotation"),this.talents=this.body.find("article.talents"),this.runes=this.body.find("article.runes"),this.filter=this.body.find("article.filter"),this.main=this.body.find("section.main"),this.sidebar=this.body.find("section.sidebar"),this.tcontainer=this.main.find(".table-container"),this.alerts=this.body.find(".alerts"),this.progress=this.main.find("progress")},events:function(){var t=this;t.sidebar.find(".js-settings").click(function(e){e.preventDefault(),$(this).toggleClass("active"),window.scrollTo(0,0),$("section.settings").css("min-height",t.body.outerHeight()+"px"),$("section.settings").toggleClass("active"),t.sidebar.find(".js-stats").removeClass("active"),t.sidebar.find(".js-profiles").removeClass("active"),$("section.stats").removeClass("active"),$("section.profiles").removeClass("active"),t.body.removeClass("sidebar-mobile-open")}),t.sidebar.find(".js-profiles").click(function(e){e.preventDefault(),$(this).toggleClass("active"),window.scrollTo(0,0),$("section.profiles").css("min-height",t.body.outerHeight()+"px"),$("section.profiles").toggleClass("active"),t.sidebar.find(".js-stats").removeClass("active"),t.sidebar.find(".js-settings").removeClass("active"),$("section.stats").removeClass("active"),$("section.settings").removeClass("active"),t.body.removeClass("sidebar-mobile-open"),SIM.PROFILES.buildProfiles()}),t.sidebar.find(".js-dps").click(function(e){e.preventDefault(),t.disableEditMode(),t.startLoading(),t.simulateDPS()}),t.sidebar.find(".js-weights").click(function(e){e.preventDefault(),t.disableEditMode(),t.startLoading(),t.simulateDPS("stats")}),t.sidebar.find(".js-stats").click(function(e){e.preventDefault(),$(this).toggleClass("active"),window.scrollTo(0,0),$("section.stats").css("min-height",t.body.outerHeight()+"px"),$("section.stats").toggleClass("active"),t.sidebar.find(".js-settings").removeClass("active"),t.sidebar.find(".js-profiles").removeClass("active"),$("section.settings").removeClass("active"),$("section.profiles").removeClass("active"),t.body.removeClass("sidebar-mobile-open")}),t.body.on("click",".js-table",function(e){e.preventDefault(),t.disableEditMode();const s=t.tcontainer.find("table.gear tbody tr");s.addClass("waiting"),t.tcontainer.find("table.gear tbody tr td:last-of-type").html(""),t.startLoading(),t.simulateDPS(s),t.sidebar.addClass("closed"),t.sidebar.find(".menu-button-container").removeClass("open"),window.innerWidth<960&&(t.sidebar.get(0).scrollTop=0),t.body.removeClass("sidebar-mobile-open")}),t.main.on("click",".js-enchant",function(e){e.preventDefault(),t.disableEditMode();const s=t.tcontainer.find("table.enchant tbody tr");s.addClass("waiting"),t.tcontainer.find("table.enchant tbody tr td:last-of-type").html(""),t.startLoading(),t.simulateDPS(s)}),t.main.on("click",".js-editmode",function(e){e.preventDefault(),$(this).toggleClass("active"),window.scrollTo(0,0),$(this).hasClass("active")?t.enableEditMode():t.disableEditMode()}),t.main.on("click",".js-export",function(e){e.preventDefault(),t.exportProfile()}),t.main.on("click",".js-import",function(e){e.preventDefault(),t.importProfile()}),t.main.find("nav li p").click(function(e){e.preventDefault(),e.stopPropagation();let s=$(this).parent();s.addClass("active"),s.siblings().removeClass("active");var i=s.data("type");let a=!1;i||(i=s.parents("[data-type]").data("type"),a=!0),t.main.find(".js-editmode").show(),t.main.find(".js-table").show(),t.main.find(".js-import").hide(),t.main.find(".js-export").hide(),"mainhand"==i||"offhand"==i||"twohand"==i?t.loadWeapons(i):"custom"==i?t.loadCustom():t.loadGear(i)}),t.tcontainer.on("click","table.gear td:not(.ppm)",function(e){var s=$(this).parents("table"),i=(s.data("type"),s.data("max")),a=$(this).parent();if(s.hasClass("editmode"))a.hasClass("hidden")?t.rowShowItem(a):t.rowHideItem(a);else{if(a.hasClass("active"))t.rowDisableItem(a);else s.find("tr.active").length>=i&&t.rowDisableItem(s.find("tr.active").last()),t.rowEnableItem(a);t.updateSession(),t.updateSidebar(),SIM.SETTINGS.buildSpells()}}),t.tcontainer.on("click","table.enchant td:not(.ppm)",function(e){var s=$(this).parents("table"),i=$(this).parent(),a=i.data("temp");if(s.hasClass("editmode"))i.hasClass("hidden")?t.rowShowEnchant(i):t.rowHideEnchant(i);else{if(i.hasClass("active"))t.rowDisableEnchant(i);else{let e=s.find('tr.active[data-temp="'+a+'"]').first();e.length&&t.rowDisableEnchant(e),t.rowEnableEnchant(i)}t.updateSession(),t.updateSidebar(),SIM.SETTINGS.buildSpells()}}),t.runes.on("click",".rune .icon",function(e){var s=$("nav").children("ul").children("li.active").find("p:first").text().toLowerCase().replace(/\s/g,""),i=$(this).closest("tr[name]").attr("name"),a=$(this).parent().attr("data-id").toString();t.loadGear(i);var n=t.tcontainer.find($(`.runes[data-type="${i}"]`)),r=n.find($(`[data-id="${a}"]`));r.hasClass("active")?t.rowDisableRunes(r):(n.children("div").each(function(e,s){t.rowDisableRunes($(s))}),t.rowEnableRunes(r)),t.updateSession(),t.updateSidebar(),SIM.SETTINGS.buildSpells(),"mainhand"==s||"offhand"==s||"twohand"==s?t.loadWeapons(s):"custom"==s?t.loadCustom():t.loadGear(s)}),t.tcontainer.on("click",".runes .icon",function(e){var s=$(this).parents(".runes"),i=$(this).parent();if(i.hasClass("active"))t.rowDisableRunes(i);else{let e=s.find(".rune.active").first();e.length&&t.rowDisableRunes(e),t.rowEnableRunes(i)}t.updateSession(),t.updateSidebar(),SIM.SETTINGS.buildSpells()}),t.sidebar.find(".menu-button-container").click(function(e){e.preventDefault(),$(this).parents(".sidebar").toggleClass("closed"),$(this).parents(".sidebar").get(0).scrollTop=0,$(this).toggleClass("open"),t.body.toggleClass("sidebar-mobile-open")}),t.tcontainer.on("keyup",'input[name="search"]',function(e){e.preventDefault(),"Escape"==e.key&&$(this).val("");let s=$(this).val();t.tcontainer.find(".gear td:nth-child(2)").each(function(){let t=$(this).get(0);!s||t.textContent.toLowerCase().indexOf(s.toLowerCase())>-1?t.parentElement.classList.remove("filtered"):t.parentElement.classList.add("filtered")})}),t.tcontainer.on("click",".filters label",function(e){e.preventDefault(),e.stopPropagation(),$(this).toggleClass("active"),globalThis[$(this).attr("id")]=$(this).hasClass("active"),t.updateSession(),t.filterGear()})},enableEditMode:function(){let t=this.tcontainer.find("table.gear").attr("data-type");"mainhand"==t||"offhand"==t||"twohand"==t?this.loadWeapons(t,!0):"custom"==t?this.loadCustom(!0):this.loadGear(t,!0)},disableEditMode:function(){this.main.find(".js-editmode").removeClass("active");let t=this.tcontainer.find("table.gear").attr("data-type");"mainhand"==t||"offhand"==t||"twohand"==t?this.loadWeapons(t,!1):"custom"==t?this.loadCustom(!1):this.loadGear(t,!1)},simulateDPS:function(t){let e=this;if(t&&0==t.length)return void e.endLoading();let s=e.sidebar.find(".dps"),i=e.sidebar.find("#dpserr"),a=e.sidebar.find("#stats"),n=e.sidebar.find("#time"),r=e.sidebar.find(".js-dps");e.sidebar.find("#weights-div").css("display","");let d="stats"===t;d&&(t=void 0),s.text(""),i.text(""),n.text("");const l={player:[void 0,void 0,void 0,Player.getConfig()],sim:Simulation.getConfig(),fullReport:!0};if(t){let e=t.parents("table").data("type");"finger"!=e&&"trinket"!=e&&"custom"!=e||(l.player=[null,e,void 0,Player.getConfig()])}if(player=new Player(...l.player),!player.mh)return e.addAlert("No weapon selected"),void e.endLoading();var o=new SimulationWorkerParallel(MAX_WORKERS,l=>{const h=l.totaldmg/l.totalduration;s.text(h.toFixed(2));const c=l.sumdps,f=l.sumdps2,g=l.iterations,p=(f-c*c/g)/(g-1)/g;i.text((1.96*Math.sqrt(p)).toFixed(2)),n.text((l.endtime-l.starttime)/1e3),a.html(l.mindps.toFixed(2)+" min&nbsp;&nbsp;&nbsp;&nbsp;"+l.maxdps.toFixed(2)+" max"),r.css("background",""),t?e.simulateRows(Array.from(t)):d?e.simulateWeights(player,h,p):e.endLoading(),SIM.STATS.initCharts(l),o=null,player=null},(t,e)=>{let i=parseInt(t/e.iterations*100);s.text((e.totaldmg/e.totalduration).toFixed(2)),r.css("background","linear-gradient(to right, transparent "+i+"%, #444 "+i+"%)")},t=>{s.text("ERROR"),console.error(t)});o.start(l)},simulateWeights:function(t,e,s){const i=this,a=i.sidebar.find(".js-weights"),n=t.auras.bloodfury?4:3;i.sidebar.find("#weights-div").css("display","block"),i.sidebar.find("#weights-div > div").addClass("loading").append('<span class="spinner"><span class="bounce1"></span><span class="bounce2"></span><span class="bounce3"></span></span>');let r=0;function d(t){const e=parseInt(100*(r+t)/n);a.css("background","linear-gradient(to right, transparent "+e+"%, #444 "+e+"%)")}const l=(t,i)=>this.simulateStat(t,i,d).then(t=>(r+=1,{weight:(t.mean-e)/i,error:1.96*Math.sqrt(s+t.varmean)/i}));function o(t,{weight:e,error:s}){const a=i.sidebar.find("#weight-"+t);a.removeClass("loading").find(".spinner").remove(),a.find(".stat-dps").text(e.toFixed(2)),a.find(".stat-error").text(s.toFixed(2))}(async function(){o("agi",await l(4,20)),o("str",await l(3,20)),o("ap",await l(0,40)),o("crit",await l(1,1)),o("hit",await l(2,1))})().then(()=>{a.css("background",""),i.endLoading()},t=>{a.css("background",""),i.sidebar.find(".dps").text("ERROR"),i.sidebar.find("#dpserr").text(""),i.endLoading(),console.error(t)})},simulateStat:function(t,e,s){return new Promise((i,a)=>{const n={player:[e,t,3,Player.getConfig()],sim:Simulation.getConfig()};new SimulationWorkerParallel(MAX_WORKERS,t=>{const e=t.totaldmg/t.totalduration,s=t.sumdps,a=t.sumdps2,n=t.iterations;i({mean:e,varmean:(a-s*s/n)/(n-1)/n})},(t,e)=>{s&&s(t/e.iterations,e.totaldmg/e.totalduration)},t=>a(t)).start(n)})},simulateRows:function(t){var e=this,s=e.sidebar.find(".js-table");const i=t.map(n=>{const r={perc:0};return r.run=(()=>{a.delete(r),this.simulateRow($(n),n=>{r.perc=n;const d=Math.floor(Array.from(i.values()).map(t=>t.perc).reduce((t,e)=>t+e,0)/t.length);if(100==d?(s.css("background",""),e.endLoading(),e.updateSession()):s.css("background","linear-gradient(to right, transparent "+d+"%, #444 "+d+"%)"),100==r.perc){const t=a.values().next().value;t&&t.run()}})}),r}),a=new Set(i);for(const t of i.slice(0,MAX_WORKERS))t.run()},simulateRow:function(t,e){var s=this,i=t.find("td:last-of-type"),a=t.parents("table").data("type"),n=t.data("id"),r=t.parents("table").hasClass("enchant"),d=1==t.data("temp"),l=parseFloat(s.sidebar.find(".dps").text());const o={player:[n,a,d?2:r?1:0,Player.getConfig()],sim:Simulation.getConfig()};var h=new SimulationWorker(d=>{let o=$("<span></span>"),c=d.totaldmg/d.totalduration,f=c-l;if(o.text(f.toFixed(2)),f>=0?o.addClass("p"):o.addClass("n"),i.text(c.toFixed(2)).append(o),s.tcontainer.find("table").each(function(){if("custom"==a)return;$(this).trigger("update");let t=[[$(this).find("th").length-1,1]];$(this).trigger("sorton",[t])}),t.removeClass("waiting"),e(100),h=null,r)for(let t of enchant[a])t.id==n&&(t.dps=c.toFixed(2));else for(let t of gear[a])t.id==n&&(t.dps=c.toFixed(2))},(t,s)=>{let a=Math.floor(t/s.iterations*100);a<100&&(e(a),i.text((s.totaldmg/s.totalduration).toFixed(2)))},t=>{i.text("ERROR"),console.error(t)});h.start(o)},rowDisableItem:function(t){var e=t.parents("table").data("type");t.removeClass("active");for(let s=0;s<gear[e].length;s++)gear[e][s].id==t.data("id")&&(gear[e][s].selected=!1)},rowEnableItem:function(t){var e=t.parents("table").data("type");t.addClass("active");for(let s=0;s<gear[e].length;s++)gear[e][s].id==t.data("id")?gear[e][s].selected=!0:"finger"!=e&&"trinket"!=e&&"custom"!=e&&(gear[e][s].selected=!1);if("twohand"==e){for(let t=0;t<gear.mainhand.length;t++)gear.mainhand[t].selected=!1;for(let t=0;t<gear.offhand.length;t++)gear.offhand[t].selected=!1;for(let t=0;t<enchant.mainhand.length;t++)enchant.mainhand[t].selected=!1;for(let t=0;t<enchant.offhand.length;t++)enchant.offhand[t].selected=!1}if("mainhand"==e||"offhand"==e){for(let t=0;t<gear.twohand.length;t++)gear.twohand[t].selected=!1;for(let t=0;t<enchant.twohand.length;t++)enchant.twohand[t].selected=!1}for(let e=0;e<spells.length;e++)!spells[e].item||spells[e].id!=t.data("id")||spells[e].timetoendactive||spells[e].timetostartactive||(spells[e].timetoendactive=!0)},rowHideItem:function(t){var e=t.parents("table").data("type");t.removeClass("active"),t.addClass("hidden"),t.find(".hide").html(eyesvghidden);for(let s=0;s<gear[e].length;s++)gear[e][s].id==t.data("id")&&(gear[e][s].hidden=!0,gear[e][s].selected=!1)},rowShowItem:function(t){var e=t.parents("table").data("type");t.removeClass("hidden"),t.find(".hide").html(eyesvg);for(let s=0;s<gear[e].length;s++)gear[e][s].id==t.data("id")&&(gear[e][s].hidden=!1)},rowDisableEnchant:function(t){var e=t.parents("table").data("type");t.removeClass("active");for(let s=0;s<enchant[e].length;s++)enchant[e][s].id==t.data("id")&&(enchant[e][s].selected=!1)},rowEnableEnchant:function(t){var e=t.parents("table").data("type");t.addClass("active");for(let s=0;s<enchant[e].length;s++)enchant[e][s].id==t.data("id")&&(enchant[e][s].selected=!0)},rowHideEnchant:function(t){var e=t.parents("table").data("type");t.removeClass("active"),t.addClass("hidden"),t.find(".hide").html(eyesvghidden);for(let s=0;s<enchant[e].length;s++)enchant[e][s].id==t.data("id")&&(enchant[e][s].hidden=!0,enchant[e][s].selected=!1)},rowShowEnchant:function(t){var e=t.parents("table").data("type");t.removeClass("hidden"),t.find(".hide").html(eyesvg);for(let s=0;s<enchant[e].length;s++)enchant[e][s].id==t.data("id")&&(enchant[e][s].hidden=!1)},rowDisableRunes:function(t){var e=t.parents(".runes").data("type");t.removeClass("active");for(let s=0;s<runes[e].length;s++)if(runes[e][s].id==t.data("id")&&(runes[e][s].selected=!1,runes[e][s].enable))for(let t of spells)t.id==runes[e][s].enable&&(t.active=!1);var s=this.body.find("article.runes"),i=$(`tr[name="${e}"]`);s.find(i).find("div").removeClass("active")},rowEnableRunes:function(t){var e=t.parents(".runes").data("type");t.addClass("active");let s=0;for(let i=0;i<runes[e].length;i++)if(runes[e][i].id==t.data("id")){if(runes[e][i].selected=!0,runes[e][i].enable)for(let t of spells)t.id==runes[e][i].enable&&(t.active=!0);s=runes[e][i].id}var i=this.body.find("article.runes"),a=$(`[data-id="${s}"]`);i.find(a).children("div").addClass("active")},startLoading:function(){let t=$(".js-dps, .js-weights, .js-table, .js-enchant");t.addClass("loading"),t.append('<span class="spinner"><span class="bounce1"></span><span class="bounce2"></span><span class="bounce3"></span></span>'),$("section.main nav").addClass("loading")},endLoading:function(){let t=$(".js-dps, .js-weights, .js-table, .js-enchant");t.removeClass("loading"),t.find(".spinner").remove(),$("section.main nav").removeClass("loading")},updateSidebar:function(){var t=new Player;let e=JSON.parse(localStorage[mode+(globalThis.profileid||0)]),s="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";if(!t.mh)return;this.sidebar.find("#str").text(t.stats.str),this.sidebar.find("#agi").text(t.stats.agi),this.sidebar.find("#ap").text(t.stats.ap),this.sidebar.find("#skill").html(t.stats["skill_"+t.mh.type]+" <small>MH</small>"+(t.oh?s+t.stats["skill_"+t.oh.type]+" <small>OH</small>":"")),this.sidebar.find("#hit").html((t.stats.hit||0)+"%"),this.sidebar.find("#miss").html(Math.max(t.mh.miss,0).toFixed(2)+"% <small>1H</small>"+(t.oh?s+Math.max(t.mh.dwmiss,0).toFixed(2)+"% <small>DW</small>":""));let i=t.crit+t.mh.crit,a=t.crit+(t.oh?t.oh.crit:0);this.sidebar.find("#crit").html(i.toFixed(2)+"% <small>MH</small>"+(t.oh?s+a.toFixed(2)+"% <small>OH</small>":""));let n=Math.max(0,100-t.mh.dwmiss-t.mh.dodge-t.mh.glanceChance),r=Math.max(0,t.oh?100-t.oh.dwmiss-t.oh.dodge-t.oh.glanceChance:0);this.sidebar.find("#critcap").html(n.toFixed(2)+"% <small>MH</small>"+(t.oh?s+r.toFixed(2)+"% <small>OH</small>":""));let d=t.stats.dmgmod*t.mh.modifier*100,l=t.stats.dmgmod*(t.oh?100*t.oh.modifier:0);this.sidebar.find("#dmgmod").html(d.toFixed(2)+"% <small>MH</small>"+(t.oh?s+l.toFixed(2)+"% <small>OH</small>":"")),this.sidebar.find("#haste").html((100*t.stats.haste).toFixed(2)+"%"),this.sidebar.find("#shadow-resist").html(t.stats.resist.shadow),this.sidebar.find("#arcane-resist").html(t.stats.resist.arcane),this.sidebar.find("#nature-resist").html(t.stats.resist.nature),this.sidebar.find("#fire-resist").html(t.stats.resist.fire),this.sidebar.find("#frost-resist").html(t.stats.resist.frost),this.sidebar.find("#race").text(e.race),this.sidebar.find("#level").text(e.level),this.sidebar.find("#sets").empty();for(let e of sets){let s=0;for(let i of e.items)t.items.includes(i)&&s++;0!=s&&(s>=e.bonus[0].count&&this.sidebar.find("#sets").append(`<a href="${WEB_DB_URL}item-set=${e.id}" class="q4">${e.name} (${s})</a><br />`))}let o=0;for(let t of talents)for(let e of t.t)o+=e.c;this.talents.find("#points").text(Math.max(t.level-9-o,0))},updateSession:function(t){let e={};e.level=this.fight.find('input[name="level"]').val(),e.race=this.fight.find('select[name="race"]').val(),e.simulations=this.fight.find('input[name="simulations"]').val(),e.timesecsmin=this.fight.find('input[name="timesecsmin"]').val(),e.timesecsmax=this.fight.find('input[name="timesecsmax"]').val(),e.executeperc=this.fight.find('input[name="executeperc"]').val(),e.startrage=this.fight.find('input[name="startrage"]').val(),e.targetlevel=this.fight.find('input[name="targetlevel"]').val(),e.targetbasearmor=this.fight.find('select[name="targetbasearmor"]').val(),e.targetresistance=this.fight.find('input[name="targetresistance"]').val(),e.targetspeed=this.fight.find('input[name="targetspeed"]').val(),e.targetmindmg=this.fight.find('input[name="targetmindmg"]').val(),e.targetmaxdmg=this.fight.find('input[name="targetmaxdmg"]').val(),e.adjacent=this.fight.find('input[name="adjacent"]').val(),e.aqbooks=this.fight.find('select[name="aqbooks"]').val(),e.reactionmin=this.fight.find('input[name="reactionmin"]').val(),e.reactionmax=this.fight.find('input[name="reactionmax"]').val(),e.batching=this.fight.find('select[name="batching"]').val(),e.filter_strength=this.main.find("#filter_strength").hasClass("active"),e.filter_bear=this.main.find("#filter_bear").hasClass("active"),e.filter_tiger=this.main.find("#filter_tiger").hasClass("active"),e.filter_green=this.main.find("#filter_green").hasClass("active"),e.filter_blue=this.main.find("#filter_blue").hasClass("active"),e.bleedreduction=this.fight.find('select[name="bleedreduction"]').val();let s=[],i=[],a=[],n=[],r=[],d={},l={},o={},h={};this.buffs.find(".active").each(function(){s.push($(this).attr("data-id"))}),this.filter.find(".sources .active").each(function(){n.push($(this).attr("data-id"))}),this.filter.find(".phases .active").each(function(){r.push($(this).attr("data-id"))});for(let t of talents){let e=[];for(let s of t.t)e.push(s.c);a.push({n:t.n,t:e})}i=spells;for(let t in gear){d[t]=[];for(let e of gear[t])d[t].push({id:e.id,selected:e.selected,dps:e.dps,hidden:e.hidden})}for(let t in enchant){l[t]=[];for(let e of enchant[t])l[t].push({id:e.id,selected:e.selected,dps:e.dps,hidden:e.hidden})}if("undefined"!=typeof runes)for(let t in runes){o[t]=[];for(let e of runes[t])o[t].push({id:e.id,selected:e.selected,hidden:e.hidden})}var c=["shadow","arcane","nature","fire","frost"];for(let t in c){var f=c[t];h[f]=$(".resistances[data-id='"+f+"-resist']").prop("checked")}e.buffs=s,e.rotation=i,e.sources=n,e.phases=r,e.talents=a,e.gear=d,e.enchant=l,e.runes=o,e.resistance=h,globalThis.profilename&&(e.profilename=globalThis.profilename);let g=globalThis.profileid||0;localStorage[mode+g]=JSON.stringify(e)},loadSession:function(){let t=globalThis.profileid||0;localStorage.level&&localStorage.clear(),localStorage[mode+t]||(localStorage[mode+t]=JSON.stringify(session)),"sod"==mode&&"2"!==localStorage.sodPatch&&(localStorage.sodPatch="2",localStorage.sod0=JSON.stringify(session));let e=JSON.parse(localStorage[mode+t]);e.level||(e.level=session.level),e.targetlevel||(e.targetlevel=session.targetlevel),e.profilename||(e.profilename=session.profilename),void 0===e.filter_strength&&(e.filter_strength=!0),void 0===e.filter_bear&&(e.filter_bear=!0),void 0===e.filter_tiger&&(e.filter_tiger=!0),void 0===e.filter_green&&(e.filter_green=!0),void 0===e.filter_blue&&(e.filter_blue=!0),globalThis.profilename=e.profilename,globalThis.filter_strength=e.filter_strength,globalThis.filter_bear=e.filter_bear,globalThis.filter_tiger=e.filter_tiger,globalThis.filter_green=e.filter_green,globalThis.filter_blue=e.filter_blue;for(let t in e)this.fight.find('input[name="'+t+'"]').val(e[t]),this.fight.find('select[name="'+t+'"]').val(e[t]),this.fight.find('.slider[name="slider-'+t+'"]').val(e[t]);this.sidebar.find(".bg").attr("data-race",this.fight.find('select[name="race"]').val()),updateGlobals({talents:e.talents?e.talents:session.talents,buffs:e.buffs?e.buffs:session.buffs,rotation:e.rotation?e.rotation:session.rotation,gear:e.gear?e.gear:session.gear,enchant:e.enchant?e.enchant:session.enchant,runes:e.runes?e.runes:session.runes||{},resistances:e.resistances?e.resistances:null});let s=e.sources?e.sources:session.sources,i=e.phases?e.phases:session.phases;for(let t of s)this.filter.find(`.sources [data-id="${t}"]`).addClass("active");for(let t of i)this.filter.find(`.phases [data-id="${t}"]`).addClass("active");var a=["shadow","arcane","nature","fire","frost"];for(let t in a){var n=a[t];$(".resistances[data-id='"+n+"-resist']").prop("checked")&&this.sidebar.find("."+n+"-resist.hidden").removeClass("hidden")}},filterGear:function(){var t=this.main.find("nav > ul > li.active").data("type");"mainhand"==t||"offhand"==t?this.loadWeapons(t):"custom"==t?this.loadCustom():this.loadGear(t)},loadWeapons:function(t,e){var s=this.main.find("nav li.active .filter .active").text();let i=JSON.parse(localStorage[mode+(globalThis.profileid||0)]),a=parseInt(i.level);SIM.UI.resistCheckList();let n=`<table class="gear ${e?"editmode":""}" data-type="${t}" data-max="1">\n                        <thead>\n                            <tr>\n                                ${e?"<th></th>":""}\n                                <th>ilvl</th>\n                                <th>Name</th>\n                                <th>Sta</th>\n                                <th>Res</th>\n                                <th>Str</th>\n                                <th>Agi</th>\n                                <th>AP</th>\n                                <th>Crit</th>\n                                <th>Hit</th>\n                                <th>Min</th>\n                                <th>Max</th>\n                                <th>Speed</th>\n                                <th>Skill</th>\n                                <th>Type</th>\n                                <th>PPM</th>\n                                <th>DPS</th>\n                            </tr>\n                        </thead>\n                    <tbody>`;for(let i of gear[t]){if(i.r>a||"sod"==mode&&i.q<3&&i.i<a-7||"sod"==mode&&3==i.q&&i.i<a-12){i.selected=!1;continue}if(!1===globalThis.filter_tiger&&i.name.toLowerCase().indexOf("of the tiger")>-1||!1===globalThis.filter_strength&&i.name.toLowerCase().indexOf("of strength")>-1||!1===globalThis.filter_bear&&i.name.toLowerCase().indexOf("of the bear")>-1||!1===globalThis.filter_green&&"2"==i.q||!1===globalThis.filter_blue&&"3"==i.q){i.selected=!1;continue}if(s)if("All"==s){if("Shield"==i.type)continue}else if("Mace & Sword"==s){if("Mace"!=i.type&&"Sword"!=i.type)continue}else if("Axe, Dagger & Sword"==s){if("Axe"!=i.type&&"Dagger"!=i.type&&"Sword"!=i.type)continue}else if(i.type!=s)continue;let t=(i.source||"").toLowerCase(),r=i.phase;if("Lethon"!=i.source&&"Emeriss"!=i.source&&"Kazzak"!=i.source&&"Azuregos"!=i.source&&"Ysondre"!=i.source&&"Taerar"!=i.source&&"Green Dragons"!=i.source||(t="worldboss"),"shadow"!=i.subsource&&"arcane"!=i.subsource&&"nature"!=i.subsource&&"fire"!=i.subsource&&"frost"!=i.subsource||(t="resistances-list"),r&&!this.filter.find('.phases [data-id="'+r+'"]').hasClass("active"))continue;if(t&&!this.filter.find('.sources [data-id="'+t+'"]').hasClass("active"))continue;if("resistances-list"===t&&!$(".resistances[data-id='"+i.subsource+"-resist']").prop("checked"))continue;if(i.hidden&&!e)continue;let d=i.id.toString().split("|")[0],l="";199211==d&&(d=19921),i.rand&&(l="?rand="+i.rand);let o="";i.resist&&(i.resist.fire&&(o+=i.resist.fire+" FiR"),i.resist.frost&&(o+=(o.length?" + ":"")+i.resist.frost+" FR"),i.resist.nature&&(o+=(o.length?" + ":"")+i.resist.nature+" NR"),i.resist.shadow&&(o+=(o.length?" + ":"")+i.resist.shadow+" SR"),i.resist.arcane&&(o+=(o.length?" + ":"")+i.resist.arcane+" AR")),n+=`<tr data-id="${i.id}" data-name="${i.name}" class="${i.selected?"active":""} ${i.hidden?"hidden":""}">\n                        ${e?'<td class="hide">'+(i.hidden?eyesvghidden:eyesvg)+"</td>":""}\n                        <td data-quality="${i.q}"><a href="${WEB_DB_URL}item=${d}${l}"></a>${i.i}</td>\n                        <td>${i.name}</td>`,n+=`<td>${i.sta||""}</td>\n                        <td>${o||""}</td>\n                        <td>${i.str||""}</td>\n                        <td>${i.agi||""}</td>\n                        <td>${i.ap||""}</td>\n                        <td>${i.crit||""}</td>\n                        <td>${i.hit||""}</td>\n                        <td>${i.mindmg||""}</td>\n                        <td>${i.maxdmg||""}</td>\n                        <td>${i.speed||""}</td>\n                        <td>${i.skill||""}</td>\n                        <td>${i.type||""}</td>\n                        <td class="ppm"><p contenteditable="true">${i.proc&&i.proc.ppm||""}</p></td>\n                        <td>${i.dps||""}</td>\n                    </tr>`}n+="</tbody></table></section>",this.tcontainer.empty(),this.tcontainer.append(`<div class="topgear">\n            <div class="search"><input name="search" placeholder="Search" />${searchSVG}</div>\n            <div class="filters">\n                <label id="filter_strength" class="${globalThis.filter_strength?"active":""}">Of Strength</label>\n                <label id="filter_bear" class="${globalThis.filter_bear?"active":""}">Of the Bear</label>\n                <label id="filter_tiger" class="${globalThis.filter_tiger?"active":""}">Of the Tiger</label>\n                <label id="filter_green" class="${globalThis.filter_green?"active":""}">Greens</label>\n                <label id="filter_blue" class="${globalThis.filter_blue?"active":""}">Blues</label>\n            </div>\n        </div>`),this.tcontainer.append(n);let r=this.tcontainer.find("table.gear th").length;this.tcontainer.find("table.gear").tablesorter({widthFixed:!1,sortList:e?[[r,1],[2,0]]:[[r-1,1],[1,0]],textSorter:{19:function(t,e,s,i,a){t=parseFloat(t.substring(0,t.indexOf(".")+3)),e=parseFloat(e.substring(0,e.indexOf(".")+3));return isNaN(t)&&(t=0),isNaN(e)&&(e=0),t<e?-1:t>e?1:0}},headers:{19:{sorter:"text"}}}),this.loadEnchants(t,e)},resistCheckList:function(){return{shadow:$(".resistances[data-id='shadow-resist']").prop("checked"),arcane:$(".resistances[data-id='arcane-resist']").prop("checked"),nature:$(".resistances[data-id='nature-resist']").prop("checked"),fire:$(".resistances[data-id='fire-resist']").prop("checked"),frost:$(".resistances[data-id='frost-resist']").prop("checked")}},loadGear:function(t,e){if(!t)return;SIM.UI.resistCheckList();let s=JSON.parse(localStorage[mode+(globalThis.profileid||0)]),i=parseInt(s.level);let a=`<table class="gear ${e?"editmode":""}" data-type="${t}" data-max="1">\n                        <thead>\n                            <tr>\n                                ${e?"<th></th>":""}\n                                <th>ilvl</th>\n                                <th>Name</th>\n                                <th>Sta</th>\n                                <th>Res</th>\n                                <th>Str</th>\n                                <th>Agi</th>\n                                <th>AP</th>\n                                <th>Hit</th>\n                                <th>Crit</th>\n                                <th>Skill</th>\n                                <th>Type</th>\n                                <th>DPS</th>\n                            </tr>\n                        </thead>\n                    <tbody>`;for(let s of gear[t]){if(s.r>i||"sod"==mode&&s.q<3&&s.i<i-7||"sod"==mode&&3==s.q&&s.i<i-12){s.selected=!1;continue}if(!1===globalThis.filter_tiger&&s.name.toLowerCase().indexOf("of the tiger")>-1||!1===globalThis.filter_strength&&s.name.toLowerCase().indexOf("of strength")>-1||!1===globalThis.filter_bear&&s.name.toLowerCase().indexOf("of the bear")>-1||!1===globalThis.filter_green&&"2"==s.q||!1===globalThis.filter_blue&&"3"==s.q){s.selected=!1;continue}let t=(s.source||"").toLowerCase(),n=s.phase;if("Lethon"!=s.source&&"Emeriss"!=s.source&&"Kazzak"!=s.source&&"Azuregos"!=s.source&&"Ysondre"!=s.source&&"Taerar"!=s.source&&"Green Dragons"!=s.source||(t="worldboss"),"shadow"!=s.subsource&&"arcane"!=s.subsource&&"nature"!=s.subsource&&"fire"!=s.subsource&&"frost"!=s.subsource||(t="resistances-list"),n&&!this.filter.find('.phases [data-id="'+n+'"]').hasClass("active"))continue;if(t&&!this.filter.find('.sources [data-id="'+t+'"]').hasClass("active"))continue;if("resistances-list"===t&&!$(".resistances[data-id='"+s.subsource+"-resist']").prop("checked"))continue;if(s.hidden&&!e)continue;let r=s.id.toString().split("|")[0],d="";145541==r&&(r=14554),198981==r&&(r=19898),s.rand&&(d="?rand="+s.rand);let l="";s.resist&&(s.resist.fire&&(l+=s.resist.fire+" FiR"),s.resist.frost&&(l+=(l.length?" + ":"")+s.resist.frost+" FR"),s.resist.nature&&(l+=(l.length?" + ":"")+s.resist.nature+" NR"),s.resist.shadow&&(l+=(l.length?" + ":"")+s.resist.shadow+" SR"),s.resist.arcane&&(l+=(l.length?" + ":"")+s.resist.arcane+" AR")),a+=`<tr data-id="${s.id}" class="${s.selected?"active":""} ${s.hidden?"hidden":""}">\n                        ${e?'<td class="hide">'+(s.hidden?eyesvghidden:eyesvg)+"</td>":""}\n                        <td data-quality="${s.q}"><a href="${WEB_DB_URL}item=${r}${d}"></a>${s.i}</td>\n                        <td>${s.name}</td>`,a+=`<td>${s.sta||""}</td>\n                        <td>${l||""}</td>\n                        <td>${s.str||""}</td>\n                        <td>${s.agi||""}</td>\n                        <td>${s.ap||""}</td>\n                        <td>${s.hit||""}</td>\n                        <td>${s.crit||""}</td>\n                        <td>${s.skill||""}</td>\n                        <td>${s.type||""}</td>\n                        <td>${s.dps||""}</td>\n                    </tr>`}a+="</tbody></table></section>",this.tcontainer.empty(),this.loadRunes(t,e),this.tcontainer.append(`<div class="topgear">\n            <div class="search"><input name="search" placeholder="Search" />${searchSVG}</div>\n            <div class="filters">\n                <label id="filter_strength" class="${globalThis.filter_strength?"active":""}">Of Strength</label>\n                <label id="filter_bear" class="${globalThis.filter_bear?"active":""}">Of the Bear</label>\n                <label id="filter_tiger" class="${globalThis.filter_tiger?"active":""}">Of the Tiger</label>\n                <label id="filter_green" class="${globalThis.filter_green?"active":""}">Greens</label>\n                <label id="filter_blue" class="${globalThis.filter_blue?"active":""}">Blues</label>\n            </div>\n        </div>`),this.tcontainer.append(a);let n=this.tcontainer.find("table.gear th").length;this.tcontainer.find("table.gear").tablesorter({widthFixed:!1,sortList:e?[[n,1],[2,0]]:[[n-1,1],[1,0]],textSorter:{19:function(t,e,s,i,a){t=parseFloat(t.substring(0,t.indexOf(".")+3)),e=parseFloat(e.substring(0,e.indexOf(".")+3));return isNaN(t)&&(t=0),isNaN(e)&&(e=0),t<e?-1:t>e?1:0}},headers:{19:{sorter:"text"}}}),this.loadEnchants(t,e),this.updateSession(),this.updateSidebar()},loadCustom:function(t){SIM.UI.resistCheckList();let e=`<table class="gear ${t?"editmode":""}" data-type="custom" data-max="10">\n                        <thead>\n                            <tr>\n                                ${t?"<th></th>":""}\n                                <th>Name</th>\n                                <th>Str</th>\n                                <th>Agi</th>\n                                <th>AP</th>\n                                <th>Hit</th>\n                                <th>Crit</th>\n                                <th>Skill</th>\n                                <th>DPS</th>\n                            </tr>\n                        </thead>\n                    <tbody>`;for(let s of gear.custom){let i="";s.resist&&(s.resist.fire&&(i+=s.resist.fire+" FiR"),s.resist.frost&&(i+=(i.length?" + ":"")+s.resist.frost+" FR"),s.resist.nature&&(i+=(i.length?" + ":"")+s.resist.nature+" NR"),s.resist.shadow&&(i+=(i.length?" + ":"")+s.resist.shadow+" SR"),s.resist.arcane&&(i+=(i.length?" + ":"")+s.resist.arcane+" AR")),s.hidden&&!t||(e+=`<tr data-id="${s.id}" class="${s.selected?"active":""} ${s.hidden?"hidden":""}">\n                        ${t?'<td class="hide">'+(s.hidden?eyesvghidden:eyesvg)+"</td>":""}\n                        <td>${s.name}</td>\n                        <td>${s.str||""}</td>\n                        <td>${s.agi||""}</td>\n                        <td>${s.ap||""}</td>\n                        <td>${s.hit||""}</td>\n                        <td>${s.crit||""}</td>\n                        <td>${s.skill_1||""}</td>\n                        <td>${s.dps||""}</td>\n                    </tr>`)}e+="</tbody></table></section>",this.tcontainer.empty(),this.tcontainer.append(e),this.tcontainer.find("table.gear").tablesorter({widthFixed:!1,sortList:t?[[9,1]]:[[8,1]]})},loadEnchants:function(t,e){this.main.find(".js-enchant").hide();let s=JSON.parse(localStorage[mode+(globalThis.profileid||0)]),i=parseInt(s.level);if(!enchant[t]||0==enchant[t].length)return;SIM.UI.resistCheckList();let a=`<table class="enchant ${e?"editmode":""}" data-type="${t}" data-max="1">\n                        <thead>\n                            <tr>\n                                ${e?"<th></th>":""}\n                                <th>Enchant</th>\n                                <th>Res</th>\n                                <th>Damage</th>\n                                <th>Str</th>\n                                <th>Agi</th>\n                                <th>AP</th>\n                                <th>Crit</th>\n                                <th>Hit</th>\n                                <th>Haste</th>\n                                <th>PPM</th>\n                                <th>DPS</th>\n                            </tr>\n                        </thead>\n                    <tbody>`;for(let s of enchant[t]){if(s.r>i){s.selected=!1;continue}if(s.phase&&!this.filter.find('.phases [data-id="'+s.phase+'"]').hasClass("active"))continue;if(s.hidden&&!e)continue;let t="";s.resist&&(s.resist.fire&&(t+=s.resist.fire+" FiR"),s.resist.frost&&(t+=(t.length?" + ":"")+s.resist.frost+" FR"),s.resist.nature&&(t+=(t.length?" + ":"")+s.resist.nature+" NR"),s.resist.shadow&&(t+=(t.length?" + ":"")+s.resist.shadow+" SR"),s.resist.arcane&&(t+=(t.length?" + ":"")+s.resist.arcane+" AR")),a+=`<tr data-id="${s.id}" data-temp="${s.temp||!1}" class="${s.selected?"active":""} ${s.hidden?"hidden":""}">\n                        ${e?'<td class="hide">'+(s.hidden?eyesvghidden:eyesvg)+"</td>":""}\n                        <td><a href="${WEB_DB_URL}${s.spellid?"spell":"item"}=${s.id}"></a>${s.name}</td>\n                        <td>${t||""}</td>\n                        <td>${s.bonusdmg||""}</td>\n                        <td>${s.str||""}</td>\n                        <td>${s.agi||""}</td>\n                        <td>${s.ap||""}</td>\n                        <td>${s.crit||""}</td>\n                        <td>${s.hit||""}</td>\n                        <td>${s.haste||""}</td>\n                        <td>${s.ppm||""}</td>\n                        <td>${s.dps||""}</td>\n                    </tr>`}a+="</tbody></table></section>",0!=$(a).find("tbody tr").length&&(this.tcontainer.append(a),this.tcontainer.find("table.enchant").tablesorter({widthFixed:!1,sortList:e?[[12,1]]:[[11,1]],headers:{11:{sorter:"text"}}}),this.main.find(".js-enchant").show())},loadRunes:function(t,e){if("undefined"==typeof runes||!runes[t]||0==runes[t].length)return;let s=$(`<div class="runes" data-type="${t}"></div>`);s.append("<label>Runes</label>");for(let e of runes[t])s.append(`\n                <div data-id="${e.id}" class="rune ${e.selected?"active":""}">\n                    <div class="icon">\n                        <img src="https://wow.zamimg.com/images/wow/icons/medium/${e.iconname}.jpg" alt="${e.name}">\n                        <a href="${WEB_DB_URL}spell=${e.id}" class="wh-tooltip"></a>\n                    </div>\n                </div>`);this.tcontainer.append(s)},addAlert:function(t){var e=this;let s=(65536*(1+Math.random())|0).toString(16).substring(1);e.alerts.empty().append(`<div id="alert${s}" class="alert"><p>${t}</p></div>`),e.alerts.find(".alert").click(function(){e.closeAlert(s)}),setTimeout(function(){e.alerts.find("#alert"+s).addClass("in-up")}),setTimeout(function(){e.closeAlert(s)},4e3)},closeAlert:function(t){var e=this;e.alerts.find("#alert"+t).removeClass("in-up"),setTimeout(function(){e.alerts.find("#alert"+t).remove()},1e3)},firstSession:function(){console.log("Welcome!")}};var eyesvg='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M15 12c0 1.654-1.346 3-3 3s-3-1.346-3-3 1.346-3 3-3 3 1.346 3 3zm9-.449s-4.252 8.449-11.985 8.449c-7.18 0-12.015-8.449-12.015-8.449s4.446-7.551 12.015-7.551c7.694 0 11.985 7.551 11.985 7.551zm-7 .449c0-2.757-2.243-5-5-5s-5 2.243-5 5 2.243 5 5 5 5-2.243 5-5z"/></svg>',eyesvghidden='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M11.885 14.988l3.104-3.098.011.11c0 1.654-1.346 3-3 3l-.115-.012zm8.048-8.032l-3.274 3.268c.212.554.341 1.149.341 1.776 0 2.757-2.243 5-5 5-.631 0-1.229-.13-1.785-.344l-2.377 2.372c1.276.588 2.671.972 4.177.972 7.733 0 11.985-8.449 11.985-8.449s-1.415-2.478-4.067-4.595zm1.431-3.536l-18.619 18.58-1.382-1.422 3.455-3.447c-3.022-2.45-4.818-5.58-4.818-5.58s4.446-7.551 12.015-7.551c1.825 0 3.456.426 4.886 1.075l3.081-3.075 1.382 1.42zm-13.751 10.922l1.519-1.515c-.077-.264-.132-.538-.132-.827 0-1.654 1.346-3 3-3 .291 0 .567.055.833.134l1.518-1.515c-.704-.382-1.496-.619-2.351-.619-2.757 0-5 2.243-5 5 0 .852.235 1.641.613 2.342z"/></svg>',searchSVG='<svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="20px" height="20px"><path d="M 21 3 C 11.621094 3 4 10.621094 4 20 C 4 29.378906 11.621094 37 21 37 C 24.710938 37 28.140625 35.804688 30.9375 33.78125 L 44.09375 46.90625 L 46.90625 44.09375 L 33.90625 31.0625 C 36.460938 28.085938 38 24.222656 38 20 C 38 10.621094 30.378906 3 21 3 Z M 21 5 C 29.296875 5 36 11.703125 36 20 C 36 28.296875 29.296875 35 21 35 C 12.703125 35 6 28.296875 6 20 C 6 11.703125 12.703125 5 21 5 Z"/></svg>';