const MAX_WORKERS=navigator.hardwareConcurrency||8;var SIM=SIM||{};SIM.UI={init:function(){this.variables(),this.events(),this.loadSession(),this.loadWeapons("mainhand"),this.updateSidebar(),this.body.on("click",".wh-tooltip, .tablesorter-default a",function(e){e.preventDefault()})},variables:function(){this.body=$("body"),this.buffs=this.body.find("article.buffs"),this.fight=this.body.find("article.fight"),this.rotation=this.body.find("article.rotation"),this.talents=this.body.find("article.talents"),this.filter=this.body.find("article.filter"),this.main=this.body.find("section.main"),this.sidebar=this.body.find("section.sidebar"),this.tcontainer=this.main.find(".table-container"),this.alerts=this.body.find(".alerts"),this.progress=this.main.find("progress")},events:function(){var e=this;e.sidebar.find(".js-settings").click(function(t){t.preventDefault(),$(this).toggleClass("active"),window.scrollTo(0,0),$("section.settings").css("min-height",e.body.outerHeight()+"px"),$("section.settings").toggleClass("active"),e.sidebar.find(".js-stats").removeClass("active"),$("section.stats").removeClass("active"),e.body.removeClass("sidebar-mobile-open")}),e.sidebar.find(".js-dps").click(function(t){t.preventDefault(),e.disableEditMode(),e.startLoading(),e.simulateDPS()}),e.sidebar.find(".js-weights").click(function(t){t.preventDefault(),e.disableEditMode(),e.startLoading(),e.simulateDPS("stats")}),e.sidebar.find(".js-stats").click(function(t){t.preventDefault(),$(this).toggleClass("active"),window.scrollTo(0,0),$("section.stats").css("min-height",e.body.outerHeight()+"px"),$("section.stats").toggleClass("active"),e.sidebar.find(".js-settings").removeClass("active"),$("section.settings").removeClass("active"),e.body.removeClass("sidebar-mobile-open")}),e.body.on("click",".js-table",function(t){t.preventDefault(),e.disableEditMode();const a=e.tcontainer.find("table.gear tbody tr");a.addClass("waiting"),e.tcontainer.find("table.gear tbody tr td:last-of-type").html(""),e.startLoading(),e.simulateDPS(a),e.sidebar.addClass("closed"),e.sidebar.find(".menu-button-container").removeClass("open"),window.innerWidth<960&&(e.sidebar.get(0).scrollTop=0),e.body.removeClass("sidebar-mobile-open")}),e.main.on("click",".js-enchant",function(t){t.preventDefault(),e.disableEditMode();const a=e.tcontainer.find("table.enchant tbody tr");a.addClass("waiting"),e.tcontainer.find("table.enchant tbody tr td:last-of-type").html(""),e.startLoading(),e.simulateDPS(a)}),e.main.on("click",".js-editmode",function(t){t.preventDefault(),$(this).toggleClass("active"),window.scrollTo(0,0),$(this).hasClass("active")?e.enableEditMode():e.disableEditMode()}),e.main.on("click",".js-export",function(t){t.preventDefault(),e.exportProfile()}),e.main.on("click",".js-import",function(t){t.preventDefault(),e.importProfile()}),e.main.find("nav li p").click(function(t){t.preventDefault(),t.stopPropagation();let a=$(this).parent();a.addClass("active"),a.siblings().removeClass("active");var i=a.data("type");let s=!1;i||(i=a.parents("[data-type]").data("type"),s=!0),e.main.find(".js-editmode").show(),e.main.find(".js-table").show(),e.main.find(".js-import").hide(),e.main.find(".js-export").hide(),"mainhand"==i||"offhand"==i||"twohand"==i?e.loadWeapons(i):"custom"==i?e.loadCustom():"profiles"==i?(e.loadProfiles(s),e.main.find(".js-editmode").hide(),e.main.find(".js-table").hide(),e.main.find(".js-enchant").hide(),e.main.find(".js-import").show(),e.main.find(".js-export").show()):e.loadGear(i)}),e.tcontainer.on("keyup",'[name="profilename"]',function(t){let a=t.target.value;e.main.find('[data-type="profiles"] .active p').html(a),e.updateSession()}),e.tcontainer.on("click","table.gear td:not(.ppm)",function(t){var a=$(this).parents("table"),i=(a.data("type"),a.data("max")),s=$(this).parent();if(a.hasClass("editmode"))s.hasClass("hidden")?e.rowShowItem(s):e.rowHideItem(s);else{if(s.hasClass("active"))e.rowDisableItem(s);else a.find("tr.active").length>=i&&e.rowDisableItem(a.find("tr.active").last()),e.rowEnableItem(s);e.updateSession(),e.updateSidebar()}}),e.tcontainer.on("click","table.enchant td:not(.ppm)",function(t){var a=$(this).parents("table"),i=$(this).parent(),s=i.data("temp");if(a.hasClass("editmode"))i.hasClass("hidden")?e.rowShowEnchant(i):e.rowHideEnchant(i);else{if(i.hasClass("active"))e.rowDisableEnchant(i);else{let t=a.find('tr.active[data-temp="'+s+'"]').first();t.length&&e.rowDisableEnchant(t),e.rowEnableEnchant(i)}e.updateSession(),e.updateSidebar()}}),e.tcontainer.on("click",".runes .icon",function(t){var a=$(this).parents(".runes"),i=$(this).parent();if(i.hasClass("active"))e.rowDisableRunes(i);else{let t=a.find(".rune.active").first();t.length&&e.rowDisableRunes(t),e.rowEnableRunes(i)}e.updateSession(),e.updateSidebar(),SIM.SETTINGS.buildSpells()}),e.sidebar.find(".menu-button-container").click(function(t){t.preventDefault(),$(this).parents(".sidebar").toggleClass("closed"),$(this).parents(".sidebar").get(0).scrollTop=0,$(this).toggleClass("open"),e.body.toggleClass("sidebar-mobile-open")})},enableEditMode:function(){let e=this.tcontainer.find("table.gear").attr("data-type");"mainhand"==e||"offhand"==e||"twohand"==e?this.loadWeapons(e,!0):"custom"==e?this.loadCustom(!0):"profiles"==e?this.loadProfiles(!0):this.loadGear(e,!0)},disableEditMode:function(){this.main.find(".js-editmode").removeClass("active");let e=this.tcontainer.find("table.gear").attr("data-type");"mainhand"==e||"offhand"==e||"twohand"==e?this.loadWeapons(e,!1):"custom"==e?this.loadCustom(!1):"profiles"==e?this.loadProfiles(!1):this.loadGear(e,!1)},simulateDPS:function(e){let t=this;if(e&&0==e.length)return void t.endLoading();let a=t.sidebar.find(".dps"),i=t.sidebar.find("#dpserr"),s=t.sidebar.find("#stats"),n=t.sidebar.find("#time"),r=t.sidebar.find(".js-dps");t.sidebar.find("#weights-div").css("display","");let d="stats"===e;d&&(e=void 0),a.text(""),i.text(""),n.text("");const o={player:[void 0,void 0,void 0,Player.getConfig()],sim:Simulation.getConfig(),fullReport:!0};if(e){let t=e.parents("table").data("type");"finger"!=t&&"trinket"!=t&&"custom"!=t||(o.player=[null,t,void 0,Player.getConfig()])}if(player=new Player(...o.player),!player.mh)return t.addAlert("No weapon selected"),void t.endLoading();var l=new SimulationWorkerParallel(MAX_WORKERS,o=>{const c=o.totaldmg/o.totalduration;a.text(c.toFixed(2));const h=o.sumdps,f=o.sumdps2,p=o.iterations,u=(f-h*h/p)/(p-1)/p;i.text((1.96*Math.sqrt(u)).toFixed(2)),n.text((o.endtime-o.starttime)/1e3),s.html(o.mindps.toFixed(2)+" min&nbsp;&nbsp;&nbsp;&nbsp;"+o.maxdps.toFixed(2)+" max"),r.css("background",""),e?t.simulateRows(Array.from(e)):d?t.simulateWeights(player,c,u):t.endLoading(),SIM.STATS.initCharts(o),l=null,player=null},(e,t)=>{let i=parseInt(e/t.iterations*100);a.text((t.totaldmg/t.totalduration).toFixed(2)),r.css("background","linear-gradient(to right, transparent "+i+"%, #444 "+i+"%)")},e=>{a.text("ERROR"),console.error(e)});l.start(o)},simulateWeights:function(e,t,a){const i=this,s=i.sidebar.find(".js-weights"),n=e.auras.bloodfury?4:3;i.sidebar.find("#weights-div").css("display","block"),i.sidebar.find("#weights-div > div").addClass("loading").append('<span class="spinner"><span class="bounce1"></span><span class="bounce2"></span><span class="bounce3"></span></span>');let r=0;function d(e){const t=parseInt(100*(r+e)/n);s.css("background","linear-gradient(to right, transparent "+t+"%, #444 "+t+"%)")}const o=(e,i)=>this.simulateStat(e,i,d).then(e=>(r+=1,{weight:(e.mean-t)/i,error:1.96*Math.sqrt(a+e.varmean)/i}));function l(e,{weight:t,error:a}){const s=i.sidebar.find("#weight-"+e);s.removeClass("loading").find(".spinner").remove(),s.find(".stat-dps").text(t.toFixed(2)),s.find(".stat-error").text(a.toFixed(2))}(async function(){const t=await o(0,50);if(l("ap",t),e.auras.bloodfury)l("str",await o(3,25));else{const a=2*e.stats.strmod;l("str",{weight:t.weight*a,error:t.error*a})}const a=await o(1,2);l("crit",a);const i=e.stats.agimod*e.agipercrit;l("agi",{weight:a.weight*i,error:a.error*i}),l("hit",await o(2,2))})().then(()=>{s.css("background",""),i.endLoading()},e=>{s.css("background",""),i.sidebar.find(".dps").text("ERROR"),i.sidebar.find("#dpserr").text(""),i.endLoading(),console.error(e)})},simulateStat:function(e,t,a){return new Promise((i,s)=>{const n={player:[t,e,3,Player.getConfig()],sim:Simulation.getConfig()};new SimulationWorkerParallel(MAX_WORKERS,e=>{const t=e.totaldmg/e.totalduration,a=e.sumdps,s=e.sumdps2,n=e.iterations;i({mean:t,varmean:(s-a*a/n)/(n-1)/n})},(e,t)=>{a&&a(e/t.iterations,t.totaldmg/t.totalduration)},e=>s(e)).start(n)})},simulateRows:function(e){var t=this,a=t.sidebar.find(".js-table");const i=e.map(n=>{const r={perc:0};return r.run=(()=>{s.delete(r),this.simulateRow($(n),n=>{r.perc=n;const d=Math.floor(Array.from(i.values()).map(e=>e.perc).reduce((e,t)=>e+t,0)/e.length);if(100==d?(a.css("background",""),t.endLoading(),t.updateSession()):a.css("background","linear-gradient(to right, transparent "+d+"%, #444 "+d+"%)"),100==r.perc){const e=s.values().next().value;e&&e.run()}})}),r}),s=new Set(i);for(const e of i.slice(0,MAX_WORKERS))e.run()},simulateRow:function(e,t){var a=this,i=e.find("td:last-of-type"),s=e.parents("table").data("type"),n=e.data("id"),r=e.parents("table").hasClass("enchant"),d=1==e.data("temp"),o=parseFloat(a.sidebar.find(".dps").text());const l={player:[n,s,d?2:r?1:0,Player.getConfig()],sim:Simulation.getConfig()};var c=new SimulationWorker(d=>{let l=$("<span></span>"),h=d.totaldmg/d.totalduration,f=h-o;if(l.text(f.toFixed(2)),f>=0?l.addClass("p"):l.addClass("n"),i.text(h.toFixed(2)).append(l),a.tcontainer.find("table").each(function(){if("custom"==s)return;$(this).trigger("update");let e=[[$(this).find("th").length-1,1]];$(this).trigger("sorton",[e])}),e.removeClass("waiting"),t(100),c=null,r)for(let e of enchant[s])e.id==n&&(e.dps=h.toFixed(2));else for(let e of gear[s])e.id==n&&(e.dps=h.toFixed(2))},(e,a)=>{let s=Math.floor(e/a.iterations*100);s<100&&(t(s),i.text((a.totaldmg/a.totalduration).toFixed(2)))},e=>{i.text("ERROR"),console.error(e)});c.start(l)},rowDisableItem:function(e){var t=e.parents("table").data("type");e.removeClass("active");for(let a=0;a<gear[t].length;a++)gear[t][a].id==e.data("id")&&(gear[t][a].selected=!1)},rowEnableItem:function(e){var t=e.parents("table").data("type");e.addClass("active");for(let a=0;a<gear[t].length;a++)gear[t][a].id==e.data("id")?gear[t][a].selected=!0:"finger"!=t&&"trinket"!=t&&"custom"!=t&&(gear[t][a].selected=!1);if("twohand"==t){for(let e=0;e<gear.mainhand.length;e++)gear.mainhand[e].selected=!1;for(let e=0;e<gear.offhand.length;e++)gear.offhand[e].selected=!1;for(let e=0;e<enchant.mainhand.length;e++)enchant.mainhand[e].selected=!1;for(let e=0;e<enchant.offhand.length;e++)enchant.offhand[e].selected=!1}if("mainhand"==t||"offhand"==t){for(let e=0;e<gear.twohand.length;e++)gear.twohand[e].selected=!1;for(let e=0;e<enchant.twohand.length;e++)enchant.twohand[e].selected=!1}},rowHideItem:function(e){var t=e.parents("table").data("type");e.removeClass("active"),e.addClass("hidden"),e.find(".hide").html(eyesvghidden);for(let a=0;a<gear[t].length;a++)gear[t][a].id==e.data("id")&&(gear[t][a].hidden=!0,gear[t][a].selected=!1)},rowShowItem:function(e){var t=e.parents("table").data("type");e.removeClass("hidden"),e.find(".hide").html(eyesvg);for(let a=0;a<gear[t].length;a++)gear[t][a].id==e.data("id")&&(gear[t][a].hidden=!1)},rowDisableEnchant:function(e){var t=e.parents("table").data("type");e.removeClass("active");for(let a=0;a<enchant[t].length;a++)enchant[t][a].id==e.data("id")&&(enchant[t][a].selected=!1)},rowEnableEnchant:function(e){var t=e.parents("table").data("type");e.addClass("active");for(let a=0;a<enchant[t].length;a++)enchant[t][a].id==e.data("id")&&(enchant[t][a].selected=!0)},rowHideEnchant:function(e){var t=e.parents("table").data("type");e.removeClass("active"),e.addClass("hidden"),e.find(".hide").html(eyesvghidden);for(let a=0;a<enchant[t].length;a++)enchant[t][a].id==e.data("id")&&(enchant[t][a].hidden=!0,enchant[t][a].selected=!1)},rowShowEnchant:function(e){var t=e.parents("table").data("type");e.removeClass("hidden"),e.find(".hide").html(eyesvg);for(let a=0;a<enchant[t].length;a++)enchant[t][a].id==e.data("id")&&(enchant[t][a].hidden=!1)},rowDisableRunes:function(e){var t=e.parents(".runes").data("type");e.removeClass("active");for(let a=0;a<runes[t].length;a++)if(runes[t][a].id==e.data("id")&&(runes[t][a].selected=!1,runes[t][a].enable))for(let e of spells)e.id==runes[t][a].enable&&(e.active=!1)},rowEnableRunes:function(e){var t=e.parents(".runes").data("type");e.addClass("active");for(let a=0;a<runes[t].length;a++)if(runes[t][a].id==e.data("id")&&(runes[t][a].selected=!0,runes[t][a].enable))for(let e of spells)e.id==runes[t][a].enable&&(e.active=!0)},startLoading:function(){let e=$(".js-dps, .js-weights, .js-table, .js-enchant");e.addClass("loading"),e.append('<span class="spinner"><span class="bounce1"></span><span class="bounce2"></span><span class="bounce3"></span></span>'),$("section.main nav").addClass("loading")},endLoading:function(){let e=$(".js-dps, .js-weights, .js-table, .js-enchant");e.removeClass("loading"),e.find(".spinner").remove(),$("section.main nav").removeClass("loading")},updateSidebar:function(){var e=new Player;let t=JSON.parse(localStorage[mode+(globalThis.profileid||0)]),a="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";if(!e.mh)return;this.sidebar.find("#str").text(e.stats.str),this.sidebar.find("#agi").text(e.stats.agi),this.sidebar.find("#ap").text(e.stats.ap),this.sidebar.find("#skill").html(e.stats["skill_"+e.mh.type]+" <small>MH</small>"+(e.oh?a+e.stats["skill_"+e.oh.type]+" <small>OH</small>":"")),this.sidebar.find("#hit").html((e.stats.hit||0)+"%"),this.sidebar.find("#miss").html(Math.max(e.mh.miss,0).toFixed(2)+"% <small>1H</small>"+(e.oh?a+Math.max(e.mh.dwmiss,0).toFixed(2)+"% <small>DW</small>":""));let i=e.crit+e.mh.crit,s=e.crit+(e.oh?e.oh.crit:0);this.sidebar.find("#crit").html(i.toFixed(2)+"% <small>MH</small>"+(e.oh?a+s.toFixed(2)+"% <small>OH</small>":""));let n=Math.max(0,100-e.mh.dwmiss-e.mh.dodge-e.mh.glanceChance),r=Math.max(0,e.oh?100-e.oh.dwmiss-e.oh.dodge-e.oh.glanceChance:0);this.sidebar.find("#critcap").html(n.toFixed(2)+"% <small>MH</small>"+(e.oh?a+r.toFixed(2)+"% <small>OH</small>":""));let d=e.stats.dmgmod*e.mh.modifier*100,o=e.stats.dmgmod*(e.oh?100*e.oh.modifier:0);this.sidebar.find("#dmgmod").html(d.toFixed(2)+"% <small>MH</small>"+(e.oh?a+o.toFixed(2)+"% <small>OH</small>":"")),this.sidebar.find("#haste").html((100*e.stats.haste).toFixed(2)+"%"),this.sidebar.find("#shadow-resist").html(e.stats.resist.shadow),this.sidebar.find("#arcane-resist").html(e.stats.resist.arcane),this.sidebar.find("#nature-resist").html(e.stats.resist.nature),this.sidebar.find("#fire-resist").html(e.stats.resist.fire),this.sidebar.find("#frost-resist").html(e.stats.resist.frost),this.sidebar.find("#race").text(t.race),this.sidebar.find("#level").text(t.level),this.sidebar.find("#sets").empty();for(let t of sets){let a=0;for(let i of t.items)e.items.includes(i)&&a++;0!=a&&(a>=t.bonus[0].count&&this.sidebar.find("#sets").append(`<a href="https://classic.wowhead.com/item-set=${t.id}" class="q4">${t.name} (${a})</a><br />`))}let l=0;for(let e of talents)for(let t of e.t)l+=t.c;this.talents.find("#points").text(Math.max(e.level-9-l,0))},updateSession:function(e){let t={};t.level=this.fight.find('input[name="level"]').val(),t.race=this.fight.find('select[name="race"]').val(),t.simulations=this.fight.find('input[name="simulations"]').val(),t.timesecsmin=this.fight.find('input[name="timesecsmin"]').val(),t.timesecsmax=this.fight.find('input[name="timesecsmax"]').val(),t.executeperc=this.fight.find('input[name="executeperc"]').val(),t.startrage=this.fight.find('input[name="startrage"]').val(),t.targetlevel=this.fight.find('input[name="targetlevel"]').val(),t.targetarmor=this.fight.find('input[name="targetarmor"]').val(),t.targetresistance=this.fight.find('input[name="targetresistance"]').val(),t.adjacent=this.fight.find('input[name="adjacent"]').val(),t.aqbooks=this.fight.find('select[name="aqbooks"]').val(),t.reactionmin=this.fight.find('input[name="reactionmin"]').val(),t.reactionmax=this.fight.find('input[name="reactionmax"]').val(),t.batching=this.fight.find('select[name="batching"]').val();let a=[],i=[],s=[],n=[],r=[],d={},o={},l={},c={};this.buffs.find(".active").each(function(){a.push($(this).attr("data-id"))}),this.filter.find(".sources .active").each(function(){n.push($(this).attr("data-id"))}),this.filter.find(".phases .active").each(function(){r.push($(this).attr("data-id"))});for(let e of talents){let t=[];for(let a of e.t)t.push(a.c);s.push({n:e.n,t:t})}i=spells;for(let e in gear){d[e]=[];for(let t of gear[e])d[e].push({id:t.id,selected:t.selected,dps:t.dps,hidden:t.hidden})}for(let e in enchant){o[e]=[];for(let t of enchant[e])o[e].push({id:t.id,selected:t.selected,dps:t.dps,hidden:t.hidden})}if("undefined"!=typeof runes)for(let e in runes){l[e]=[];for(let t of runes[e])l[e].push({id:t.id,selected:t.selected,hidden:t.hidden})}var h=["shadow","arcane","nature","fire","frost"];for(let e in h){var f=h[e];c[f]=$(".resistances[data-id='"+f+"-resist']").prop("checked")}t.buffs=a,t.rotation=i,t.sources=n,t.phases=r,t.talents=s,t.gear=d,t.enchant=o,t.runes=l,t.resistance=c,t.profilename=this.main.find('[data-type="profiles"] .active p').text();let p=globalThis.profileid||0;localStorage[mode+p]=JSON.stringify(t)},loadSession:function(){let e=globalThis.profileid||0;localStorage.level&&localStorage.clear(),localStorage[mode+e]||(localStorage[mode+e]=JSON.stringify(session));let t=JSON.parse(localStorage[mode+e]);t.level||(t.level=session.level),t.targetlevel||(t.targetlevel=session.targetlevel),t.profilename||(t.profilename=session.profilename);for(let e in t)this.fight.find('input[name="'+e+'"]').val(t[e]),this.fight.find('select[name="'+e+'"]').val(t[e]),this.fight.find('.slider[name="slider-'+e+'"]').val(t[e]);this.sidebar.find(".bg").attr("data-race",this.fight.find('select[name="race"]').val()),updateGlobals({talents:t.talents?t.talents:session.talents,buffs:t.buffs?t.buffs:session.buffs,rotation:t.rotation?t.rotation:session.rotation,gear:t.gear?t.gear:session.gear,enchant:t.enchant?t.enchant:session.enchant,runes:t.runes?t.runes:session.runes||{},resistances:t.resistances?t.resistances:null});let a=t.sources?t.sources:session.sources,i=t.phases?t.phases:session.phases;for(let e of a)this.filter.find(`.sources [data-id="${e}"]`).addClass("active");for(let e of i)this.filter.find(`.phases [data-id="${e}"]`).addClass("active");var s=["shadow","arcane","nature","fire","frost"];for(let e in s){var n=s[e];$(".resistances[data-id='"+n+"-resist']").prop("checked")&&this.sidebar.find("."+n+"-resist.hidden").removeClass("hidden")}for(let e=0;e<=9;e++){if(void 0===localStorage[mode+e])continue;let t=JSON.parse(localStorage[mode+e]);t&&t.profilename&&(this.main.find('[data-type="profiles"] .filter p')[e].innerText=t.profilename)}},filterGear:function(){var e=this.main.find("nav > ul > li.active").data("type");"mainhand"==e||"offhand"==e?this.loadWeapons(e):"custom"==e?this.loadCustom():"profiles"==e?this.loadProfiles():this.loadGear(e)},loadProfiles:function(e){var t=this.main.find("nav li.active .filter .active").index();let a=mode+t,i=mode+globalThis.profileid;if(globalThis.profileid=t,void 0===localStorage[a]){localStorage[a]=localStorage[i];let e=JSON.parse(localStorage[a]);e.profilename=this.main.find("nav li.active .filter .active p").text(),localStorage[a]=JSON.stringify(e)}this.loadSession(),this.updateSidebar(),SIM.SETTINGS.buildSpells(),SIM.SETTINGS.buildBuffs(),SIM.SETTINGS.buildTalents(),SIM.SETTINGS.buildRunes();let s=JSON.parse(localStorage[a]);this.tcontainer.empty(),this.tcontainer.append(`<div class="profileoption">\n            <label>Edit name:</label>\n            <input type="text" name="profilename" value="${s.profilename}">\n        </div>`),this.tcontainer.append('<textarea class="profilejson" name="profilejson"></textarea>'),e&&this.addAlert(`${s.profilename} loaded`)},loadWeapons:function(e,t){var a=this.main.find("nav li.active .filter .active").text();let i=JSON.parse(localStorage[mode+(globalThis.profileid||0)]),s=parseInt(i.level);SIM.UI.resistCheckList();let n=`<table class="gear ${t?"editmode":""}" data-type="${e}" data-max="1">\n                        <thead>\n                            <tr>\n                                ${t?"<th></th>":""}\n                                <th>Name</th>\n                                <th>Sta</th>\n                                <th>Str</th>\n                                <th>Agi</th>\n                                <th>AP</th>\n                                <th>Crit</th>\n                                <th>Hit</th>\n                                <th>Min</th>\n                                <th>Max</th>\n                                <th>Speed</th>\n                                <th>Skill</th>\n                                <th>Resist</th>\n                                <th>Type</th>\n                                <th>PPM</th>\n                                <th>DPS</th>\n                            </tr>\n                        </thead>\n                    <tbody>`;for(let i of gear[e]){if(i.r>s||i.r<s-20||0==i.r){i.selected=!1;continue}if(a)if("All"==a){if("Shield"==i.type)continue}else if("Mace & Sword"==a){if("Mace"!=i.type&&"Sword"!=i.type)continue}else if("Axe, Dagger & Sword"==a){if("Axe"!=i.type&&"Dagger"!=i.type&&"Sword"!=i.type)continue}else if(i.type!=a)continue;let e=(i.source||"").toLowerCase(),r=i.phase;if("Lethon"!=i.source&&"Emeriss"!=i.source&&"Kazzak"!=i.source&&"Azuregos"!=i.source&&"Ysondre"!=i.source&&"Taerar"!=i.source&&"Green Dragons"!=i.source||(e="worldboss"),"shadow"!=i.subsource&&"arcane"!=i.subsource&&"nature"!=i.subsource&&"fire"!=i.subsource&&"frost"!=i.subsource||(e="resistances-list"),r&&!this.filter.find('.phases [data-id="'+r+'"]').hasClass("active"))continue;if(e&&!this.filter.find('.sources [data-id="'+e+'"]').hasClass("active"))continue;if("resistances-list"===e&&!$(".resistances[data-id='"+i.subsource+"-resist']").prop("checked"))continue;if(i.hidden&&!t)continue;let d=i.id,o="";199211==d&&(d=19921),i.rand&&(o="?rand="+i.rand);let l="";i.resist&&(i.resist.fire&&(l+=i.resist.fire+" FiR"),i.resist.frost&&(l+=(l.length?"<br />":"")+i.resist.frost+" FR"),i.resist.nature&&(l+=(l.length?"<br />":"")+i.resist.nature+" NR"),i.resist.shadow&&(l+=(l.length?"<br />":"")+i.resist.shadow+" SR")),n+=`<tr data-id="${i.id}" data-name="${i.name}" class="${i.selected?"active":""} ${i.hidden?"hidden":""}">\n                        ${t?'<td class="hide">'+(i.hidden?eyesvghidden:eyesvg)+"</td>":""}\n                        <td><a href="https://classic.wowhead.com/item=${d}${o}"></a>${i.name}</td>`,n+=`<td>${i.sta||""}</td>\n                        <td>${i.str||""}</td>\n                        <td>${i.agi||""}</td>\n                        <td>${i.ap||""}</td>\n                        <td>${i.crit||""}</td>\n                        <td>${i.hit||""}</td>\n                        <td>${i.mindmg||""}</td>\n                        <td>${i.maxdmg||""}</td>\n                        <td>${i.speed||""}</td>\n                        <td>${i.skill||""}</td>\n                        <td>${l||""}</td>\n                        <td>${i.type||""}</td>\n                        <td class="ppm"><p contenteditable="true">${i.proc&&i.proc.ppm||""}</p></td>\n                        <td>${i.dps||""}</td>\n                    </tr>`}n+="</tbody></table></section>",this.tcontainer.empty(),this.tcontainer.append(n);let r=this.tcontainer.find("table.gear th").length;this.tcontainer.find("table.gear").tablesorter({widthFixed:!1,sortList:t?[[r,1],[1,0]]:[[r-1,1],[0,0]],textSorter:{19:function(e,t,a,i,s){e=parseFloat(e.substring(0,e.indexOf(".")+3)),t=parseFloat(t.substring(0,t.indexOf(".")+3));return isNaN(e)&&(e=0),isNaN(t)&&(t=0),e<t?-1:e>t?1:0}},headers:{19:{sorter:"text"}}}),this.loadEnchants(e,t)},resistCheckList:function(){return{shadow:$(".resistances[data-id='shadow-resist']").prop("checked"),arcane:$(".resistances[data-id='arcane-resist']").prop("checked"),nature:$(".resistances[data-id='nature-resist']").prop("checked"),fire:$(".resistances[data-id='fire-resist']").prop("checked"),frost:$(".resistances[data-id='frost-resist']").prop("checked")}},loadGear:function(e,t){if(!e)return;SIM.UI.resistCheckList();let a=JSON.parse(localStorage[mode+(globalThis.profileid||0)]),i=parseInt(a.level);let s=`<table class="gear ${t?"editmode":""}" data-type="${e}" data-max="1">\n                        <thead>\n                            <tr>\n                                ${t?"<th></th>":""}\n                                <th>Name</th>\n                                <th>Sta</th>\n                                <th>Str</th>\n                                <th>Agi</th>\n                                <th>AP</th>\n                                <th>Hit</th>\n                                <th>Crit</th>\n                                <th>Skill</th>\n                                <th>Resist</th>\n                                <th>Type</th>\n                                <th>DPS</th>\n                            </tr>\n                        </thead>\n                    <tbody>`;for(let a of gear[e]){if(a.r>i||a.r<i-20&&0!==a.r){a.selected=!1;continue}let e=(a.source||"").toLowerCase(),n=a.phase;if("Lethon"!=a.source&&"Emeriss"!=a.source&&"Kazzak"!=a.source&&"Azuregos"!=a.source&&"Ysondre"!=a.source&&"Taerar"!=a.source&&"Green Dragons"!=a.source||(e="worldboss"),"shadow"!=a.subsource&&"arcane"!=a.subsource&&"nature"!=a.subsource&&"fire"!=a.subsource&&"frost"!=a.subsource||(e="resistances-list"),n&&!this.filter.find('.phases [data-id="'+n+'"]').hasClass("active"))continue;if(e&&!this.filter.find('.sources [data-id="'+e+'"]').hasClass("active"))continue;if("resistances-list"===e&&!$(".resistances[data-id='"+a.subsource+"-resist']").prop("checked"))continue;if(a.hidden&&!t)continue;let r=a.id,d="";145541==r&&(r=14554),198981==r&&(r=19898),a.rand&&(d="?rand="+a.rand);let o="";a.resist&&(a.resist.fire&&(o+=a.resist.fire+" FiR"),a.resist.frost&&(o+=(o.length?"<br />":"")+a.resist.frost+" FR"),a.resist.nature&&(o+=(o.length?"<br />":"")+a.resist.nature+" NR"),a.resist.shadow&&(o+=(o.length?"<br />":"")+a.resist.shadow+" SR")),s+=`<tr data-id="${a.id}" class="${a.selected?"active":""} ${a.hidden?"hidden":""}">\n                        ${t?'<td class="hide">'+(a.hidden?eyesvghidden:eyesvg)+"</td>":""}\n                        <td><a href="https://classic.wowhead.com/item=${r}${d}"></a>${a.name}</td>`,s+=`<td>${a.sta||""}</td>\n                        <td>${a.str||""}</td>\n                        <td>${a.agi||""}</td>\n                        <td>${a.ap||""}</td>\n                        <td>${a.hit||""}</td>\n                        <td>${a.crit||""}</td>\n                        <td>${a.skill||""}</td>\n                        <td>${o||""}</td>\n                        <td>${a.type||""}</td>\n                        <td>${a.dps||""}</td>\n                    </tr>`}s+="</tbody></table></section>",this.tcontainer.empty(),this.loadRunes(e,t),this.tcontainer.append(s);let n=this.tcontainer.find("table.gear th").length;this.tcontainer.find("table.gear").tablesorter({widthFixed:!1,sortList:t?[[n,1],[1,0]]:[[n-1,1],[0,0]],textSorter:{19:function(e,t,a,i,s){e=parseFloat(e.substring(0,e.indexOf(".")+3)),t=parseFloat(t.substring(0,t.indexOf(".")+3));return isNaN(e)&&(e=0),isNaN(t)&&(t=0),e<t?-1:e>t?1:0}},headers:{19:{sorter:"text"}}}),this.loadEnchants(e,t),this.updateSession(),this.updateSidebar()},loadCustom:function(e){SIM.UI.resistCheckList();let t=`<table class="gear ${e?"editmode":""}" data-type="custom" data-max="10">\n                        <thead>\n                            <tr>\n                                ${e?"<th></th>":""}\n                                <th>Name</th>\n                                <th>Str</th>\n                                <th>Agi</th>\n                                <th>AP</th>\n                                <th>Hit</th>\n                                <th>Crit</th>\n                                <th>Skill</th>\n                                <th>Resist</th>\n                                <th>DPS</th>\n                            </tr>\n                        </thead>\n                    <tbody>`;for(let a of gear.custom){let i="";a.resist&&(a.resist.fire&&(i+=a.resist.fire+" FiR"),a.resist.frost&&(i+=(i.length?"<br />":"")+a.resist.frost+" FR"),a.resist.nature&&(i+=(i.length?"<br />":"")+a.resist.nature+" NR"),a.resist.shadow&&(i+=(i.length?"<br />":"")+a.resist.shadow+" SR")),a.hidden&&!e||(t+=`<tr data-id="${a.id}" class="${a.selected?"active":""} ${a.hidden?"hidden":""}">\n                        ${e?'<td class="hide">'+(a.hidden?eyesvghidden:eyesvg)+"</td>":""}\n                        <td>${a.name}</td>\n                        <td>${a.str||""}</td>\n                        <td>${a.agi||""}</td>\n                        <td>${a.ap||""}</td>\n                        <td>${a.hit||""}</td>\n                        <td>${a.crit||""}</td>\n                        <td>${a.skill_1||""}</td>\n                        <td>${i||""}</td>\n                        <td>${a.dps||""}</td>\n                    </tr>`)}t+="</tbody></table></section>",this.tcontainer.empty(),this.tcontainer.append(t),this.tcontainer.find("table.gear").tablesorter({widthFixed:!1,sortList:e?[[11,1]]:[[10,1]]})},loadEnchants:function(e,t){this.main.find(".js-enchant").hide();let a=JSON.parse(localStorage[mode+(globalThis.profileid||0)]),i=parseInt(a.level);if(!enchant[e]||0==enchant[e].length)return;SIM.UI.resistCheckList();let s=`<table class="enchant ${t?"editmode":""}" data-type="${e}" data-max="1">\n                        <thead>\n                            <tr>\n                                ${t?"<th></th>":""}\n                                <th>Enchant</th>\n                                <th>Str</th>\n                                <th>Agi</th>\n                                <th>AP</th>\n                                <th>Haste</th>\n                                <th>Resist</th>\n                                <th>Crit</th>\n                                <th>Hit</th>\n                                <th>Damage</th>\n                                <th>PPM</th>\n                                <th>DPS</th>\n                            </tr>\n                        </thead>\n                    <tbody>`;for(let a of enchant[e]){if(a.r>i){a.selected=!1;continue}if(a.phase&&!this.filter.find('.phases [data-id="'+a.phase+'"]').hasClass("active"))continue;if(a.hidden&&!t)continue;let e="";a.resist&&(a.resist.fire&&(e+=a.resist.fire+" FiR"),a.resist.frost&&(e+=(e.length?"<br />":"")+a.resist.frost+" FR"),a.resist.nature&&(e+=(e.length?"<br />":"")+a.resist.nature+" NR"),a.resist.shadow&&(e+=(e.length?"<br />":"")+a.resist.shadow+" SR")),s+=`<tr data-id="${a.id}" data-temp="${a.temp||!1}" class="${a.selected?"active":""} ${a.hidden?"hidden":""}">\n                        ${t?'<td class="hide">'+(a.hidden?eyesvghidden:eyesvg)+"</td>":""}\n                        <td><a href="https://classic.wowhead.com/${a.spellid?"spell":"item"}=${a.id}"></a>${a.name}</td>\n                        <td>${a.str||""}</td>\n                        <td>${a.agi||""}</td>\n                        <td>${a.ap||""}</td>\n                        <td>${a.haste||""}</td>\n                        <td>${e||""}</td>\n                        <td>${a.crit||""}</td>\n                        <td>${a.hit||""}</td>\n                        <td>${a.bonusdmg||""}</td>\n                        <td>${a.ppm||""}</td>\n                        <td>${a.dps||""}</td>\n                    </tr>`}s+="</tbody></table></section>",0!=$(s).find("tbody tr").length&&(this.tcontainer.append(s),this.tcontainer.find("table.enchant").tablesorter({widthFixed:!1,sortList:t?[[14,1]]:[[13,1]],headers:{13:{sorter:"text"}}}),this.main.find(".js-enchant").show())},loadRunes:function(e,t){if("undefined"==typeof runes||!runes[e]||0==runes[e].length)return;let a=$(`<div class="runes" data-type="${e}"></div>`);a.append("<label>Runes</label>");for(let t of runes[e])a.append(`\n                <div data-id="${t.id}" class="rune ${t.selected?"active":""}">\n                    <div class="icon">\n                        <img src="dist/img/${t.iconname}.jpg " alt="Bloodrage">\n                        <a href="https://classic.wowhead.com/spell=${t.id}" class="wh-tooltip"></a>\n                    </div>\n                </div>`);this.tcontainer.append(a)},addAlert:function(e){var t=this;let a=(65536*(1+Math.random())|0).toString(16).substring(1);t.alerts.empty().append(`<div id="alert${a}" class="alert"><p>${e}</p></div>`),t.alerts.find(".alert").click(function(){t.closeAlert(a)}),setTimeout(function(){t.alerts.find("#alert"+a).addClass("in-up")}),setTimeout(function(){t.closeAlert(a)},4e3)},closeAlert:function(e){var t=this;t.alerts.find("#alert"+e).removeClass("in-up"),setTimeout(function(){t.alerts.find("#alert"+e).remove()},1e3)},firstSession:function(){console.log("Welcome!")},exportProfile:function(){let e=JSON.parse(localStorage[mode+(globalThis.profileid||0)]),t={};for(let a in e)"string"==typeof e[a]&&(t[a]=e[a]);t.buffs=e.buffs,t.talents=e.talents,t.gear={};for(let a in e.gear)for(let i of e.gear[a])i.selected&&(t.gear[a]=i.id);t.rotation=[];for(let a of e.rotation)if(a.active){let e={};e.id=a.id,void 0!==a.duration&&(e.duration=a.duration),void 0!==a.durationactive&&(e.durationactive=a.durationactive),void 0!==a.timetoend&&(e.timetoend=a.timetoend),void 0!==a.crusaders&&(e.crusaders=a.crusaders),void 0!==a.haste&&(e.haste=a.haste),void 0!==a.procblock&&(e.procblock=a.procblock),void 0!==a.rageblock&&(e.rageblock=a.rageblock),void 0!==a.rageblockactive&&(e.rageblockactive=a.rageblockactive),void 0!==a.erageblock&&(e.erageblock=a.rageblock),void 0!==a.erageblockactive&&(e.erageblockactive=a.erageblockactive),void 0!==a.chargeblock&&(e.chargeblock=a.chargeblock),void 0!==a.chargeblockactive&&(e.chargeblockactive=a.chargeblockactive),void 0!==a.echargeblock&&(e.echargeblock=a.echargeblock),void 0!==a.echargeblockactive&&(e.echargeblockactive=a.echargeblockactive),void 0!==a.minrage&&(e.minrage=a.minrage),void 0!==a.minrageactive&&(e.minrageactive=a.minrageactive),void 0!==a.maxrage&&(e.maxrage=a.maxrage),void 0!==a.maxrageactive&&(e.maxrageactive=a.maxrageactive),void 0!==a.maincd&&(e.maincd=a.maincd),void 0!==a.maincdactive&&(e.maincdactive=a.maincdactive),void 0!==a.priorityap&&(e.priorityap=a.priorityap),void 0!==a.priorityapactive&&(e.priorityapactive=a.priorityapactive),void 0!==a.flagellation&&(e.flagellation=a.flagellation),void 0!==a.consumedrage&&(e.consumedrage=a.consumedrage),void 0!==a.unqueue&&(e.unqueue=a.unqueue),void 0!==a.unqueueactive&&(e.unqueueactive=a.unqueueactive),void 0!==a.exmacro&&(e.exmacro=a.exmacro),void 0!==a.globals&&(e.globals=a.globals),void 0!==a.globalsactive&&(e.globalsactive=a.globalsactive),t.rotation.push(e)}t.runes={};for(let a in e.runes)for(let i of e.runes[a])i.selected&&(t.runes[a]=i.id);t.enchant={};for(let a in e.enchant)for(let i of e.enchant[a])i.selected&&(t.enchant[a]||(t.enchant[a]=[]),t.enchant[a].push(i.id));let a=btoa(JSON.stringify(t));this.main.find('[name="profilejson"]').val(a),navigator.clipboard.writeText(a),this.addAlert("Profile copied to clipboard")},importProfile(){const e=this;try{let t=e.main.find('[name="profilejson"]').val(),a="{"==t[0]?JSON.parse(t):JSON.parse(atob(t)),i=JSON.parse(localStorage[mode+(globalThis.profileid||0)]);for(let e in a)"string"==typeof a[e]&&(i[e]=a[e]);i.buffs=a.buffs,i.talents=a.talents;for(let e in i.gear)for(let t of i.gear[e])t.id==a.gear[e]?t.selected=!0:delete t.selected;for(let e of i.rotation){let t=a.rotation.filter(t=>t.id==e.id)[0];t?(e.active=!0,void 0!==t.duration&&(e.duration=t.duration),void 0!==t.durationactive&&(e.durationactive=t.durationactive),void 0!==t.timetoend&&(e.timetoend=t.timetoend),void 0!==t.crusaders&&(e.crusaders=t.crusaders),void 0!==t.haste&&(e.haste=t.haste),void 0!==t.procblock&&(e.procblock=t.procblock),void 0!==t.rageblock&&(e.rageblock=t.rageblock),void 0!==t.rageblockactive&&(e.rageblockactive=t.rageblockactive),void 0!==t.erageblock&&(e.erageblock=t.erageblock),void 0!==t.erageblockactive&&(e.erageblockactive=t.erageblockactive),void 0!==t.chargeblock&&(e.chargeblock=t.chargeblock),void 0!==t.chargeblockactive&&(e.chargeblockactive=t.chargeblockactive),void 0!==t.echargeblock&&(e.echargeblock=t.echargeblock),void 0!==t.echargeblockactive&&(e.echargeblockactive=t.echargeblockactive),void 0!==t.minrage&&(e.minrage=t.minrage),void 0!==t.minrageactive&&(e.minrageactive=t.minrageactive),void 0!==t.maxrage&&(e.maxrage=t.maxrage),void 0!==t.maxrageactive&&(e.maxrageactive=t.maxrageactive),void 0!==t.maincd&&(e.maincd=t.maincd),void 0!==t.maincdactive&&(e.maincdactive=t.maincdactive),void 0!==t.priorityap&&(e.priorityap=t.priorityap),void 0!==t.priorityapactive&&(e.priorityapactive=t.priorityapactive),void 0!==t.flagellation&&(e.flagellation=t.flagellation),void 0!==t.consumedrage&&(e.consumedrage=t.consumedrage),void 0!==t.unqueue&&(e.unqueue=t.unqueue),void 0!==t.unqueueactive&&(e.unqueueactive=t.unqueueactive),void 0!==t.exmacro&&(e.exmacro=t.exmacro),void 0!==t.globals&&(e.globals=t.globals),void 0!==t.globalsactive&&(e.globalsactive=t.globalsactive)):e.active=!1}for(let e in i.runes)for(let t of i.runes[e])t.id==a.runes[e]?t.selected=!0:delete t.selected;for(let e in i.enchant)for(let t of i.enchant[e])a.enchant[e]&&a.enchant[e].includes(t.id)?t.selected=!0:delete t.selected;e.main.find('[name="profilejson"]').val(""),localStorage[mode+(globalThis.profileid||0)]=JSON.stringify(i),e.loadProfiles(!0)}catch(t){e.addAlert("Invalid profile")}}};var eyesvg='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M15 12c0 1.654-1.346 3-3 3s-3-1.346-3-3 1.346-3 3-3 3 1.346 3 3zm9-.449s-4.252 8.449-11.985 8.449c-7.18 0-12.015-8.449-12.015-8.449s4.446-7.551 12.015-7.551c7.694 0 11.985 7.551 11.985 7.551zm-7 .449c0-2.757-2.243-5-5-5s-5 2.243-5 5 2.243 5 5 5 5-2.243 5-5z"/></svg>',eyesvghidden='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M11.885 14.988l3.104-3.098.011.11c0 1.654-1.346 3-3 3l-.115-.012zm8.048-8.032l-3.274 3.268c.212.554.341 1.149.341 1.776 0 2.757-2.243 5-5 5-.631 0-1.229-.13-1.785-.344l-2.377 2.372c1.276.588 2.671.972 4.177.972 7.733 0 11.985-8.449 11.985-8.449s-1.415-2.478-4.067-4.595zm1.431-3.536l-18.619 18.58-1.382-1.422 3.455-3.447c-3.022-2.45-4.818-5.58-4.818-5.58s4.446-7.551 12.015-7.551c1.825 0 3.456.426 4.886 1.075l3.081-3.075 1.382 1.42zm-13.751 10.922l1.519-1.515c-.077-.264-.132-.538-.132-.827 0-1.654 1.346-3 3-3 .291 0 .567.055.833.134l1.518-1.515c-.704-.382-1.496-.619-2.351-.619-2.757 0-5 2.243-5 5 0 .852.235 1.641.613 2.342z"/></svg>';