var RESULT={HIT:0,MISS:1,DODGE:2,CRIT:3,GLANCE:4},batching=0,step=0,log=!1,version=4;const TYPE={UPDATE:0,FINISHED:1,ERROR:2};class SimulationWorker{constructor(e,s,a){this.worker=new Worker("./dist/js/sim-worker.min.js"),this.worker.onerror=((...e)=>{a(...e),this.worker.terminate()}),this.worker.onmessage=(r=>{const[t,...l]=r.data;switch(t){case TYPE.UPDATE:s(...l);break;case TYPE.FINISHED:e(...l),this.worker.terminate();break;case TYPE.ERROR:a(...l),this.worker.terminate();break;default:a(`Unexpected type: ${t}`),this.worker.terminate()}})}start(e){e.globals=getGlobalsDelta(),this.worker.postMessage(e)}}class SimulationWorkerParallel{constructor(e,s,a,r){this.threads=e,this.callback_finished=s,this.callback_update=a,this.states=[...Array(this.threads)],this.workers=this.states.map((e,s)=>new SimulationWorker(e=>{this.states[s]={status:1,data:e},this.update()},(e,a)=>{this.states[s]={status:0,iteration:e,data:a},this.update()},e=>{this.error||(this.error=e,r(e))}))}update(){if(this.error)return;if(this.states.reduce((e,s)=>e+(s&&s.status||0),0)>=this.states.length){const e=this.states[0].data;this.states.slice(1).forEach(({data:s})=>{if(e.iterations+=s.iterations,e.totaldmg+=s.totaldmg,e.totalduration+=s.totalduration,e.mindps=Math.min(e.mindps,s.mindps),e.maxdps=Math.min(e.maxdps,s.maxdps),e.sumdps+=s.sumdps,e.sumdps2+=s.sumdps2,e.starttime=Math.min(e.starttime,s.starttime),e.endtime=Math.min(e.endtime,s.endtime),e.spread&&s.spread)for(let a in s.spread)e.spread[a]=(e.spread[a]||0)+s.spread[a];if(e.player&&s.player){for(let a in s.player.auras){const r=s.player.auras[a],t=e.player.auras[a];t?(t.uptime+=r.uptime,r.uses&&(t.uses+=r.uses),r.totaldmg&&(t.totaldmg=(t.totaldmg||0)+r.totaldmg)):e.player.auras[a]=r}for(let a in s.player.spells){const r=s.player.spells[a],t=e.player.spells[a];if(t){t.totaldmg+=r.totaldmg;for(let e=0;e<r.data.length;++e)t.data[e]+=r.data[e]}else e.player.spells[a]=r}function a(e,s){if(e){e.totaldmg+=s.totaldmg,e.totalprocdmg+=s.totalprocdmg;for(let a=0;a<s.data.length;++a)e.data[a]+=s.data[a];return e}return s}e.player.mh=a(e.player.mh,s.player.mh),s.player.oh&&(e.player.oh=a(e.player.oh,s.player.oh))}}),this.callback_finished(e)}else{let e=0;const s={iterations:this.iterations,totaldmg:0,totalduration:0};this.states.forEach(a=>{a&&(e+=a.status?a.data.iterations:a.iteration,s.totaldmg+=a.data.totaldmg,s.totalduration+=a.data.totalduration)}),this.callback_update(e,s)}}start(e){e.globals=getGlobalsDelta(),this.iterations=e.sim.iterations;let s=e.sim.iterations;this.workers.forEach((a,r)=>{const t=Math.round(s/(this.workers.length-r));s-=t,a.start({...e,sim:{...e.sim,iterations:t}})})}}class Simulation{static getConfig(){return{timesecsmin:parseInt($('input[name="timesecsmin"]').val()),timesecsmax:parseInt($('input[name="timesecsmax"]').val()),executeperc:parseInt($('input[name="executeperc"]').val()),startrage:parseInt($('input[name="startrage"]').val()),iterations:parseInt($('input[name="simulations"]').val()),batching:parseInt($('select[name="batching"]').val())}}constructor(e,s,a,r){r||(r=Simulation.getConfig()),this.player=e,this.timesecsmin=r.timesecsmin,this.timesecsmax=r.timesecsmax,this.executeperc=r.executeperc,this.startrage=r.startrage,this.iterations=r.iterations,batching=r.batching,this.idmg=0,this.totaldmg=0,this.totalduration=0,this.mindps=99999,this.maxdps=0,this.sumdps=0,this.sumdps2=0,this.maxcallstack=Math.min(Math.floor(this.iterations/10),1e3),this.starttime=0,this.endtime=0,this.cb_update=a,this.cb_finished=s,this.spread=[],log=1==this.iterations}startSync(){let e;for(this.starttime=(new Date).getTime(),e=1;e<=this.iterations;++e)this.run(),e%this.maxcallstack==0&&this.update(e);this.endtime=(new Date).getTime(),this.finished()}startAsync(){this.starttime=(new Date).getTime(),this.runAsync(1)}runAsync(e){this.run(),e==this.iterations?(this.endtime=(new Date).getTime(),this.finished()):e%this.maxcallstack==0?(this.update(e),setTimeout(()=>this.runAsync(e+1),0)):this.runAsync(e+1)}run(){step=0,this.idmg=0;let e,s,a=this.player;a.reset(this.startrage),this.maxsteps=rng(1e3*this.timesecsmin,1e3*this.timesecsmax),this.duration=this.maxsteps/1e3,this.executestep=this.maxsteps-parseInt(this.maxsteps*(this.executeperc/100));let r=!1,t=!1,l=0,i=0,p=0,o=0;for(let e of a.preporder)e.aura?o+=a.auras[e.classname.toLowerCase()].prep(this.maxsteps,o):a.spells[e.classname.toLowerCase()].prep&&a.spells[e.classname.toLowerCase()].prep(this.maxsteps);for(a.auras.recklessness&&a.auras.recklessness.stoptime&&(p=this.maxsteps-1e3*a.auras.recklessness.stoptime);step<this.maxsteps;){if(0!=l&&step%3e3==0&&a.talents.angermanagement&&(a.rage=a.rage>=99?100:a.rage+1,r=!0,a.auras.consumedrage&&a.rage>=80&&a.rage<81&&a.auras.consumedrage.use()),a.vaelbuff&&0!=l&&step%1e3==0&&(a.rage=a.rage>=80?100:a.rage+20,r=!0,a.auras.consumedrage&&a.rage>=80&&a.auras.consumedrage.use()),a.target.speed&&step%a.target.speed==0){let e=a.rage,s=rng(a.target.mindmg,a.target.maxdmg),t=s/a.rageconversion*2.5;a.rage=Math.min(a.rage+t,100),r=!0,a.auras.consumedrage&&a.rage>=80&&e<80&&a.auras.consumedrage.use(),log&&this.player.log(`Target attack for ${s} gained ${t.toFixed(2)} rage `)}if(p&&step>p&&(a.timer=2e4,a.mh.timer=2e4,a.oh.timer=2e4),!i){if(a.mh.timer<=0&&(this.idmg+=a.attackmh(a.mh),r=!0),a.oh&&a.oh.timer<=0&&(this.idmg+=a.attackoh(a.oh),r=!0),r&&!a.spelldelay&&(a.auras.swarmguard&&a.auras.swarmguard.canUse()?(a.spelldelay=1,e=a.auras.swarmguard):a.auras.mightyragepotion&&a.auras.mightyragepotion.canUse()?(a.spelldelay=1,e=a.auras.mightyragepotion):a.spells.ragepotion&&a.spells.ragepotion.canUse()?(a.spelldelay=1,e=a.spells.ragepotion):a.auras.mildlyirradiated&&a.auras.mildlyirradiated.canUse()?(a.spelldelay=1,e=a.auras.mildlyirradiated):!a.timer&&a.spells.berserkerrage&&a.spells.berserkerrage.zerkerpriority&&a.spells.berserkerrage.canUse()?(a.spelldelay=1,e=a.spells.berserkerrage):a.spells.bloodrage&&a.spells.bloodrage.canUse()?(a.spelldelay=1,e=a.spells.bloodrage):a.auras.cloudkeeper&&a.auras.cloudkeeper.canUse()?(a.spelldelay=1,e=a.auras.cloudkeeper):a.auras.voidmadness&&a.auras.voidmadness.canUse()?(a.spelldelay=1,e=a.auras.voidmadness):a.auras.gyromaticacceleration&&a.auras.gyromaticacceleration.canUse()?(a.spelldelay=1,e=a.auras.gyromaticacceleration):a.auras.gneurological&&a.auras.gneurological.canUse()?(a.spelldelay=1,e=a.auras.gneurological):a.auras.coinflip&&a.auras.coinflip.canUse()?(a.spelldelay=1,e=a.auras.coinflip):a.auras.pummeler&&a.auras.pummeler.canUse()?(a.spelldelay=1,e=a.auras.pummeler):a.auras.slayer&&a.auras.slayer.canUse()?(a.spelldelay=1,e=a.auras.slayer):a.auras.spider&&a.auras.spider.canUse()?(a.spelldelay=1,e=a.auras.spider):a.auras.gabbar&&a.auras.gabbar.canUse()?(a.spelldelay=1,e=a.auras.gabbar):a.auras.earthstrike&&a.auras.earthstrike.canUse()?(a.spelldelay=1,e=a.auras.earthstrike):a.auras.zandalarian&&a.auras.zandalarian.canUse()?(a.spelldelay=1,e=a.auras.zandalarian):a.timer||(a.stance!=a.basestance?a.switch(a.basestance):a.spells.victoryrush&&a.spells.victoryrush.canUse()?(a.spelldelay=1,e=a.spells.victoryrush):a.auras.flask&&a.auras.flask.canUse()?(a.spelldelay=1,e=a.auras.flask):a.auras.recklessness&&a.auras.recklessness.canUse()?(a.spelldelay=1,e=a.auras.recklessness):a.auras.deathwish&&a.auras.deathwish.canUse()?(a.spelldelay=1,e=a.auras.deathwish):a.auras.bloodfury&&a.auras.bloodfury.canUse()?(a.spelldelay=1,e=a.auras.bloodfury):a.auras.berserking&&a.auras.berserking.canUse()?(a.spelldelay=1,e=a.auras.berserking):a.spells.berserkerrage&&a.spells.berserkerrage.canUse()?(a.spelldelay=1,e=a.spells.berserkerrage):a.spells.execute&&step>=this.executestep?a.spells.ragingblow&&a.spells.ragingblow.canUse(!0)?(a.spelldelay=1,e=a.spells.ragingblow):a.spells.berserkerrage&&a.spells.berserkerrage.canUse()?(a.spelldelay=1,e=a.spells.berserkerrage):a.spells.slam&&a.freeslam&&a.spells.slam.canUse()?(a.spelldelay=1,e=a.spells.slam):a.auras.consumedrage&&a.auras.consumedrage.erageblock&&a.rage<a.auras.consumedrage.erageblock||a.auras.consumedrage&&a.auras.consumedrage.echargeblock&&a.auras.consumedrage.stacks<a.auras.consumedrage.echargeblock&&a.rage<80||(a.stats.ap>=a.spells.execute.priorityap?a.spells.bloodthirst&&a.spells.bloodthirst.canUse()?(a.spelldelay=1,e=a.spells.bloodthirst):a.spells.mortalstrike&&a.spells.mortalstrike.canUse()&&(a.spelldelay=1,e=a.spells.mortalstrike):a.spells.execute.canUse()&&(a.spelldelay=1,e=a.spells.execute)):a.spells.ragingblow&&a.spells.ragingblow.canUse(!1)?(a.spelldelay=1,e=a.spells.ragingblow):a.spells.slam&&a.freeslam&&a.spells.slam.canUse()?(a.spelldelay=1,e=a.spells.slam):a.auras.consumedrage&&a.auras.consumedrage.procblock&&!a.auras.consumedrage.timer&&a.rage<80||a.auras.consumedrage&&a.auras.consumedrage.rageblock&&a.rage<a.auras.consumedrage.rageblock||a.auras.consumedrage&&a.auras.consumedrage.chargeblock&&a.auras.consumedrage.stacks<a.auras.consumedrage.chargeblock&&a.rage<80||(a.auras.rampage&&a.auras.rampage.canUse()?(a.spelldelay=1,e=a.auras.rampage):a.spells.overpower&&a.spells.overpower.canUse()?(a.spelldelay=1,e=a.spells.overpower):a.auras.rend&&a.auras.rend.canUse()?(a.spelldelay=1,e=a.auras.rend):a.spells.bloodthirst&&a.spells.bloodthirst.canUse()?(a.spelldelay=1,e=a.spells.bloodthirst):a.spells.mortalstrike&&a.spells.mortalstrike.canUse()?(a.spelldelay=1,e=a.spells.mortalstrike):a.precisetiming&&a.spells.slam&&a.spells.slam.canUse()?(a.spelldelay=1,e=a.spells.slam):a.spells.whirlwind&&a.spells.whirlwind.canUse()?(a.spelldelay=1,e=a.spells.whirlwind):!a.precisetiming&&a.spells.slam&&a.spells.slam.canUse()?(a.spelldelay=1,e=a.spells.slam):a.spells.quickstrike&&a.spells.quickstrike.canUse()?(a.spelldelay=1,e=a.spells.quickstrike):a.spells.sunderarmor&&a.spells.sunderarmor.canUse()?(a.spelldelay=1,e=a.spells.sunderarmor):a.spells.hamstring&&a.spells.hamstring.canUse()&&(a.spelldelay=1,e=a.spells.hamstring))),a.heroicdelay&&(r=!1)),r&&!a.heroicdelay&&((!a.spells.execute||step<this.executestep)&&(a.auras.consumedrage&&a.auras.consumedrage.procblock&&!a.auras.consumedrage.timer&&a.rage<80||a.auras.consumedrage&&a.auras.consumedrage.rageblock&&a.rage<a.auras.consumedrage.rageblock||a.auras.consumedrage&&a.auras.consumedrage.chargeblock&&a.auras.consumedrage.stacks<a.auras.consumedrage.chargeblock&&a.rage<80||(a.spells.heroicstrike&&a.spells.heroicstrike.canUse()?(a.heroicdelay=1,s=a.spells.heroicstrike):a.spells.cleave&&a.spells.cleave.canUse()&&(a.heroicdelay=1,s=a.spells.cleave))),r=!1),a.spelldelay&&e&&(t||a.spelldelay>e.maxdelay))if(a.heroicdelay&&s&&a.heroicdelay>s.maxdelay&&(a.heroicdelay=s.maxdelay-99),e.canUse()){if(e instanceof Slam){i=step+e.casttime,a.freeslam&&(i=step),a.timer=1500,a.heroicdelay=0,a.nextswinghs=!1,l=0,log&&this.player.log("Casting Slam");continue}let t=a.cast(e,s);if(this.idmg+=t,a.spelldelay=0,r=!0,e instanceof Whirlwind)for(let r=0;r<a.adjacent;r++)t=a.cast(e,s,a.adjacent,t),this.idmg+=t}else a.spelldelay=0;a.heroicdelay&&s&&a.heroicdelay>s.maxdelay&&(s.canUse()?(a.cast(s),a.heroicdelay=0,r=!0):a.heroicdelay=0),(!a.spells.execute||step<this.executestep)&&(a.spells.heroicstrike&&a.spells.heroicstrike.unqueue&&a.nextswinghs&&a.rage<a.spells.heroicstrike.unqueue&&a.mh.timer<=a.spells.heroicstrike.unqueuetimer?(this.player.nextswinghs=!1,log&&this.player.log("Heroic Strike unqueued")):a.spells.cleave&&a.spells.cleave.unqueue&&a.nextswinghs&&a.rage<a.spells.cleave.unqueue&&a.mh.timer<=a.spells.cleave.unqueuetimer&&(this.player.nextswinghs=!1,log&&this.player.log("Cleave unqueued")))}if(i&&step==i){let t=a.cast(e,s);this.idmg+=t,r=!0,i=0}if(a.extraattacks>0&&(a.mh.timer=0,a.extraattacks--),a.batchedextras>0&&(a.mh.timer=batching-step%batching,a.batchedextras--),i)l=i-step;else{if(!a.mh.timer||!a.spelldelay&&r||!a.heroicdelay&&r){l=0;continue}l=Math.min(a.mh.timer,a.oh?a.oh.timer:9999),a.spelldelay&&e.maxdelay-a.spelldelay<l&&(l=e.maxdelay-a.spelldelay+1),a.heroicdelay&&s.maxdelay-a.heroicdelay<l&&(l=s.maxdelay-a.heroicdelay+1)}if(a.timer&&a.timer<l&&(l=a.timer),a.itemtimer&&a.itemtimer<l&&(l=a.itemtimer),a.target.speed&&a.target.speed-step%a.target.speed<l&&(l=a.target.speed-step%a.target.speed),a.talents.angermanagement&&3e3-step%3e3<l&&(l=3e3-step%3e3),a.vaelbuff&&1e3-step%1e3<l&&(l=1e3-step%1e3),a.auras.bloodrage&&a.auras.bloodrage.timer&&1e3-(step-a.auras.bloodrage.starttimer)%1e3<l&&(l=1e3-(step-a.auras.bloodrage.starttimer)%1e3),a.auras.gabbar&&a.auras.gabbar.timer&&2e3-(step-a.auras.gabbar.starttimer)%2e3<l&&(l=2e3-(step-a.auras.gabbar.starttimer)%2e3),a.auras.rend&&a.auras.rend.timer&&3e3-(step-a.auras.rend.starttimer)%3e3<l&&(l=3e3-(step-a.auras.rend.starttimer)%3e3),a.auras.deepwounds&&a.auras.deepwounds.timer&&a.auras.deepwounds.nexttick-step<l&&(l=a.auras.deepwounds.nexttick-step),a.adjacent&&(a.auras.deepwounds2&&a.auras.deepwounds2.timer&&a.auras.deepwounds2.nexttick-step<l&&(l=a.auras.deepwounds2.nexttick-step),a.auras.deepwounds3&&a.auras.deepwounds3.timer&&a.auras.deepwounds3.nexttick-step<l&&(l=a.auras.deepwounds3.nexttick-step),a.auras.deepwounds4&&a.auras.deepwounds4.timer&&a.auras.deepwounds4.nexttick-step<l&&(l=a.auras.deepwounds4.nexttick-step)),a.auras.weaponbleedmh&&a.auras.weaponbleedmh.timer&&a.auras.weaponbleedmh.interval-(step-a.auras.weaponbleedmh.starttimer)%a.auras.weaponbleedmh.interval<l&&(l=a.auras.weaponbleedmh.interval-(step-a.auras.weaponbleedmh.starttimer)%a.auras.weaponbleedmh.interval),a.auras.weaponbleedoh&&a.auras.weaponbleedoh.timer&&a.auras.weaponbleedoh.interval-(step-a.auras.weaponbleedoh.starttimer)%a.auras.weaponbleedoh.interval<l&&(l=a.auras.weaponbleedoh.interval-(step-a.auras.weaponbleedoh.starttimer)%a.auras.weaponbleedoh.interval),a.spells.bloodthirst&&a.spells.bloodthirst.timer&&a.spells.bloodthirst.timer<l&&(l=a.spells.bloodthirst.timer),a.spells.mortalstrike&&a.spells.mortalstrike.timer&&a.spells.mortalstrike.timer<l&&(l=a.spells.mortalstrike.timer),a.spells.quickstrike&&a.spells.quickstrike.timer&&a.spells.quickstrike.timer<l&&(l=a.spells.quickstrike.timer),a.spells.ragingblow&&a.spells.ragingblow.timer&&a.spells.ragingblow.timer<l&&(l=a.spells.ragingblow.timer),a.spells.whirlwind&&a.spells.whirlwind.timer&&a.spells.whirlwind.timer<l&&(l=a.spells.whirlwind.timer),a.spells.bloodrage&&a.spells.bloodrage.timer&&a.spells.bloodrage.timer<l&&(l=a.spells.bloodrage.timer),a.spells.ragepotion&&a.spells.ragepotion.timer&&a.spells.ragepotion.timer<l&&(l=a.spells.ragepotion.timer),a.spells.overpower&&a.spells.overpower.timer&&a.spells.overpower.timer<l&&(l=a.spells.overpower.timer),a.spells.execute&&a.spells.execute.timer&&a.spells.execute.timer<l&&(l=a.spells.execute.timer),a.spells.slam&&a.spells.slam.timer&&a.spells.slam.timer<l&&(l=a.spells.slam.timer),!a.spells.execute||step<this.executestep)if(a.spells.heroicstrike&&a.spells.heroicstrike.unqueue){let e=Math.max(a.mh.timer-a.spells.heroicstrike.unqueuetimer);e>0&&e<l&&(l=e)}else if(a.spells.cleave&&a.spells.cleave.unqueue){let e=Math.max(a.mh.timer-a.spells.cleave.unqueuetimer);e>0&&e<l&&(l=e)}if((step+=l)>this.maxsteps)break;a.mh.step(l),a.oh&&a.oh.step(l),t=!1,a.timer&&a.steptimer(l)&&!a.spelldelay&&(r=!0,t=!0),a.itemtimer&&a.stepitemtimer(l)&&!a.spelldelay&&(r=!0),a.dodgetimer&&a.stepdodgetimer(l),a.spelldelay&&(a.spelldelay+=l),a.heroicdelay&&(a.heroicdelay+=l),a.spells.ragingblow&&a.spells.ragingblow.timer&&!a.spells.ragingblow.step(l)&&!a.spelldelay&&(r=!0),a.spells.berserkerrage&&a.spells.berserkerrage.timer&&!a.spells.berserkerrage.step(l)&&!a.spelldelay&&(r=!0),a.spells.bloodthirst&&a.spells.bloodthirst.timer&&!a.spells.bloodthirst.step(l)&&!a.spelldelay&&(r=!0),a.spells.mortalstrike&&a.spells.mortalstrike.timer&&!a.spells.mortalstrike.step(l)&&!a.spelldelay&&(r=!0),a.spells.quickstrike&&a.spells.quickstrike.timer&&!a.spells.quickstrike.step(l)&&!a.spelldelay&&(r=!0),a.spells.whirlwind&&a.spells.whirlwind.timer&&!a.spells.whirlwind.step(l)&&!a.spelldelay&&(r=!0),a.spells.bloodrage&&a.spells.bloodrage.timer&&!a.spells.bloodrage.step(l)&&!a.spelldelay&&(r=!0),a.spells.ragepotion&&a.spells.ragepotion.timer&&!a.spells.ragepotion.step(l)&&!a.spelldelay&&(r=!0),a.spells.overpower&&a.spells.overpower.timer&&!a.spells.overpower.step(l)&&!a.spelldelay&&(r=!0),a.spells.execute&&a.spells.execute.timer&&!a.spells.execute.step(l)&&!a.spelldelay&&(r=!0),a.spells.hamstring&&a.spells.hamstring.timer&&!a.spells.hamstring.step(l)&&!a.spelldelay&&(r=!0),a.spells.sunderarmor&&a.spells.sunderarmor.timer&&!a.spells.sunderarmor.step(l)&&!a.spelldelay&&(r=!0),a.spells.slam&&a.spells.slam.timer&&!a.spells.slam.step(l)&&!a.spelldelay&&(r=!0),a.auras.bloodrage&&a.auras.bloodrage.timer&&!a.auras.bloodrage.step()&&!a.spelldelay&&(r=!0),a.auras.gabbar&&a.auras.gabbar.timer&&a.auras.gabbar.step(),a.auras.rend&&a.auras.rend.timer&&!a.auras.rend.step()&&!a.spelldelay&&(r=!0),a.auras.deepwounds&&a.auras.deepwounds.timer&&!a.auras.deepwounds.step()&&!a.spelldelay&&(r=!0),a.auras.weaponbleedmh&&a.auras.weaponbleedmh.timer&&!a.auras.weaponbleedmh.step()&&!a.spelldelay&&(r=!0),a.auras.weaponbleedoh&&a.auras.weaponbleedoh.timer&&!a.auras.weaponbleedoh.step()&&!a.spelldelay&&(r=!0),a.adjacent&&(a.auras.deepwounds2&&a.auras.deepwounds2.timer&&!a.auras.deepwounds2.step()&&!a.spelldelay&&(r=!0),a.auras.deepwounds3&&a.auras.deepwounds3.timer&&!a.auras.deepwounds3.step()&&!a.spelldelay&&(r=!0),a.auras.deepwounds4&&a.auras.deepwounds4.timer&&!a.auras.deepwounds4.step()&&!a.spelldelay&&(r=!0))}a.endauras(),a.auras.deepwounds&&(this.idmg+=a.auras.deepwounds.idmg),a.auras.deepwounds2&&(this.idmg+=a.auras.deepwounds2.idmg),a.auras.deepwounds3&&(this.idmg+=a.auras.deepwounds3.idmg),a.auras.deepwounds4&&(this.idmg+=a.auras.deepwounds4.idmg),a.auras.rend&&(this.idmg+=a.auras.rend.idmg),a.auras.weaponbleedmh&&(this.idmg+=a.auras.weaponbleedmh.idmg),a.auras.weaponbleedoh&&(this.idmg+=a.auras.weaponbleedoh.idmg),this.totaldmg+=this.idmg,this.totalduration+=this.duration;let d=this.idmg/this.duration;d<this.mindps&&(this.mindps=d),d>this.maxdps&&(this.maxdps=d),this.sumdps+=d,this.sumdps2+=d*d,d=Math.round(d),this.spread[d]?this.spread[d]++:this.spread[d]=1}update(e){this.cb_update&&this.cb_update(e,{iterations:this.iterations,totaldmg:this.totaldmg,totalduration:this.totalduration})}finished(){this.cb_finished&&this.cb_finished({iterations:this.iterations,totaldmg:this.totaldmg,totalduration:this.totalduration,mindps:this.mindps,maxdps:this.maxdps,sumdps:this.sumdps,sumdps2:this.sumdps2,starttime:this.starttime,endtime:this.endtime})}}function rng(e,s){return~~(Math.random()*(s-e+1)+e)}function rng10k(){return~~(1e4*Math.random())}function avg(e,s){return(e+s)/2}